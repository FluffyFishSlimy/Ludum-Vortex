/* Copyright 2019 Luke Pacholski & Bobby Richter */
window.__soundSettings={sound:{sounds:{ui:{url:"sounds/ui.wav",volume:"0.23",limit:0,ducking:{gain:.85,attack:.008,sustain:.03,release:.08}},"round-start":{url:"sounds/round-start.mp3",volume:"0.84",limit:0,ducking:{gain:.6,attack:.3,sustain:2.6,release:0}},beep:{url:"sounds/beep.mp3",volume:"0.15",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Power_Shot_V1:{url:"sounds/Power_Shot_V1.mp3",volume:"0.68",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Power_Shot_V2:{url:"sounds/Power_Shot_V2.mp3",volume:"0.67",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Power_Shot_V3:{url:"sounds/Power_Shot_V3.mp3",volume:"0.68",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Power_Shot_V4:{url:"sounds/Power_Shot_V4.mp3",volume:"0.67",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Ball_Score_V1:{url:"sounds/Ball_Score_V1.mp3",volume:"0.96",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Ball_Score_V2:{url:"sounds/Ball_Score_V2.mp3",volume:"0.96",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Ball_Score_V3:{url:"sounds/Ball_Score_V3.mp3",volume:"0.96",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Ball_Score_V4:{url:"sounds/Ball_Score_V4.mp3",volume:"0.95",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Bomb_Impact_Low_V1:{url:"sounds/Bomb_Impact_Low_V1.mp3",volume:"0.19",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Bomb_Impact_Low_V2:{url:"sounds/Bomb_Impact_Low_V2.mp3",volume:"0.19",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Bomb_Impact_Low_V3:{url:"sounds/Bomb_Impact_Low_V3.mp3",volume:"0.19",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Ball_Bounce_Paddle:{url:"sounds/Ball_Bounce_Paddle 1.2.mp3",volume:"0.01",limit:100,ducking:{gain:.87,attack:.003,sustain:0,release:.09}},Ball_Bounce_Wall:{url:"sounds/Ball_Bounce_Wall 1.2.mp3",volume:"0.01",limit:100,ducking:{gain:.87,attack:.003,sustain:0,release:.09}},Ball_Bounce_OwnEndzone_V1:{url:"sounds/Ball_Bounce_OwnEndzone_V1.mp3",volume:"1",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Ball_Bounce_OwnEndzone_V2:{url:"sounds/Ball_Bounce_OwnEndzone_V2.mp3",volume:"1",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Ball_Bounce_OwnEndzone_V3:{url:"sounds/Ball_Bounce_OwnEndzone_V3.mp3",volume:"1",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Disapear_1:{url:"sounds/Powerup_Bones_Disapear_1.mp3",volume:"0.55",limit:0,ducking:{gain:.76,attack:.003,sustain:0,release:.09}},Powerup_Bones_Disapear_2:{url:"sounds/Powerup_Bones_Disapear_2.mp3",volume:"0.55",limit:0,ducking:{gain:.76,attack:.003,sustain:0,release:.09}},Powerup_Bones_Disapear_3:{url:"sounds/Powerup_Bones_Disapear_3.mp3",volume:"0.55",limit:0,ducking:{gain:.76,attack:.003,sustain:0,release:.09}},Powerup_Bones_Disapear_4:{url:"sounds/Powerup_Bones_Disapear_4.mp3",volume:"0.55",limit:0,ducking:{gain:.76,attack:.003,sustain:0,release:.09}},Powerup_Bones_Disapear_5:{url:"sounds/Powerup_Bones_Disapear_5.mp3",volume:"0.55",limit:0,ducking:{gain:.76,attack:.003,sustain:0,release:.09}},Powerup_Bones_Disapear_6:{url:"sounds/Powerup_Bones_Disapear_6.mp3",volume:"0.55",limit:0,ducking:{gain:.76,attack:.003,sustain:0,release:.09}},Powerup_Bones_Collision_Low_V1:{url:"sounds/Powerup_Bones_Collision_Low_V1.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V2:{url:"sounds/Powerup_Bones_Collision_Low_V2.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V3:{url:"sounds/Powerup_Bones_Collision_Low_V3.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V4:{url:"sounds/Powerup_Bones_Collision_Low_V4.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V5:{url:"sounds/Powerup_Bones_Collision_Low_V5.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V6:{url:"sounds/Powerup_Bones_Collision_Low_V6.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V7:{url:"sounds/Powerup_Bones_Collision_Low_V7.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V8:{url:"sounds/Powerup_Bones_Collision_Low_V8.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V9:{url:"sounds/Powerup_Bones_Collision_Low_V9.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V10:{url:"sounds/Powerup_Bones_Collision_Low_V10.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V11:{url:"sounds/Powerup_Bones_Collision_Low_V11.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V12:{url:"sounds/Powerup_Bones_Collision_Low_V12.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Collision_Low_V13:{url:"sounds/Powerup_Bones_Collision_Low_V13.mp3",volume:1,limit:350,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Bones_Deselect:{url:"sounds/Powerup_Bones_Deselect.mp3",volume:"0.68",limit:0,ducking:{gain:.81,attack:.006,sustain:.17,release:.09}},Powerup_Bones_Score:{url:"sounds/Powerup_Bones_Score.mp3",volume:"0.68",limit:0,ducking:{gain:.81,attack:.006,sustain:.17,release:.09}},Powerup_Enhance_Score:{url:"sounds/Powerup_Enhance_Score.mp3",volume:"0.88",limit:0,ducking:{gain:.81,attack:.006,sustain:.16,release:.14}},Powerup_Spin_Score:{url:"sounds/Powerup_Spin_Score.mp3",volume:"0.89",limit:0,ducking:{gain:.81,attack:.006,sustain:.1,release:.14}},Powerup_Ghost_Score:{url:"sounds/Powerup_Ghost_Score.mp3",volume:"1",limit:0,ducking:{gain:.81,attack:.006,sustain:.16,release:.2}},Powerup_Ghost_WareOff:{url:"sounds/Powerup_Ghost_WareOff.mp3",volume:"0.74",limit:500,ducking:{gain:.81,attack:.006,sustain:.16,release:.2}},Powerup_Sticky_Score:{url:"sounds/Powerup_Sticky_Score.mp3",volume:"0.85",limit:0,ducking:{gain:.81,attack:.006,sustain:.15,release:.15}},Powerup_Sticky_WareOff:{url:"sounds/Powerup_Sticky_WareOff.mp3",volume:"0.78",limit:500,ducking:{gain:.81,attack:.04,sustain:.1,release:.15}},Powerup_Sticky_Hit_V1:{url:"sounds/Powerup_Sticky_Hit_V1.mp3",volume:"0.44",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Sticky_Hit_V2:{url:"sounds/Powerup_Sticky_Hit_V2.mp3",volume:"0.44",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Sticky_Hit_V3:{url:"sounds/Powerup_Sticky_Hit_V3.mp3",volume:"0.44",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Sticky_Hit_V4:{url:"sounds/Powerup_Sticky_Hit_V4.mp3",volume:"0.45",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Sticky_Hit_V5:{url:"sounds/Powerup_Sticky_Hit_V5.mp3",volume:"0.46",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Sticky_Hit_V6:{url:"sounds/Powerup_Sticky_Hit_V6.mp3",volume:"0.46",limit:200,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Spin_Wall_Bounce_V1:{url:"sounds/Powerup_Spin_Wall_Bounce_V1.mp3",volume:"0.55",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Spin_Wall_Bounce_V2:{url:"sounds/Powerup_Spin_Wall_Bounce_V2.mp3",volume:"0.55",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Spin_Wall_Bounce_V3:{url:"sounds/Powerup_Spin_Wall_Bounce_V3.mp3",volume:"0.56",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Spin_Wall_Bounce_V4:{url:"sounds/Powerup_Spin_Wall_Bounce_V4.mp3",volume:"0.56",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Enhance_WareOff:{url:"sounds/Powerup_Enhance_WareOff.mp3",volume:"0.89",limit:500,ducking:{gain:.81,attack:.08,sustain:.08,release:.14}},Powerup_Spin_WareOff:{url:"sounds/Powerup_Spin_WareOff.mp3",volume:"0.93",limit:500,ducking:{gain:.81,attack:.08,sustain:.08,release:.14}},Bomb_Explosion_V1:{url:"sounds/Bomb_Explosion_V1.mp3",volume:"0.96",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Bomb_Explosion_V2:{url:"sounds/Bomb_Explosion_V2.mp3",volume:"0.96",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V1:{url:"sounds/Paddle_Spin_V1.mp3",volume:"0.6",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V2:{url:"sounds/Paddle_Spin_V2.mp3",volume:"0.6",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V3:{url:"sounds/Paddle_Spin_V3.mp3",volume:"0.6",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V4:{url:"sounds/Paddle_Spin_V4.mp3",volume:"0.6",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V5:{url:"sounds/Paddle_Spin_V5.mp3",volume:"0.59",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V6:{url:"sounds/Paddle_Spin_V6.mp3",volume:"0.59",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V7:{url:"sounds/Paddle_Spin_V7.mp3",volume:"0.59",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V8:{url:"sounds/Paddle_Spin_V8.mp3",volume:"0.59",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V9:{url:"sounds/Paddle_Spin_V9.mp3",volume:"0.6",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V10:{url:"sounds/Paddle_Spin_V10.mp3",volume:"0.62",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V11:{url:"sounds/Paddle_Spin_V11.mp3",volume:"0.6",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V12:{url:"sounds/Paddle_Spin_V12.mp3",volume:"0.6",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V13:{url:"sounds/Paddle_Spin_V13.mp3",volume:"0.61",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V14:{url:"sounds/Paddle_Spin_V14.mp3",volume:"0.6",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Spin_V15:{url:"sounds/Paddle_Spin_V15.mp3",volume:"0.61",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Dash_V1:{url:"sounds/Paddle_Dash_V1.mp3",volume:"1",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Dash_V2:{url:"sounds/Paddle_Dash_V2.mp3",volume:"1",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Dash_V3:{url:"sounds/Paddle_Dash_V3.mp3",volume:"1",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Dash_V4:{url:"sounds/Paddle_Dash_V4.mp3",volume:1,limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Paddle_Dash_V5:{url:"sounds/Paddle_Dash_V5.mp3",volume:1,limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Spawn:{url:"sounds/Powerup_Spawn.mp3",volume:"0.43",limit:0,ducking:{gain:.8,attack:.03,sustain:.1,release:.12}},Bomb_Spawn:{url:"sounds/Bomb_Spawn.mp3",volume:"0.42",limit:0,ducking:{gain:.8,attack:.04,sustain:.17,release:.12}},Bomb_Disable:{url:"sounds/Bomb_Disable.mp3",volume:"0.44",limit:0,ducking:{gain:.8,attack:.04,sustain:.17,release:.12}},Menu_Move:{url:"sounds/Menu_Move.mp3",volume:"0.13",limit:0,ducking:{gain:.75,attack:.004,sustain:0,release:.09}},Powerup_Bounce_Paddle:{url:"sounds/Powerup_Bounce_Paddle.mp3",volume:"0.27",limit:170,ducking:{gain:.9,attack:.04,sustain:.06,release:.19}},Powerup_Bounce_Wall:{url:"sounds/Powerup_Bounce_Wall.mp3",volume:"0.27",limit:170,ducking:{gain:.9,attack:.04,sustain:.06,release:.19}},Win_Cheer:{url:"sounds/Win_Cheer.mp3",volume:"0.78",limit:0,ducking:{gain:.65,attack:.2,sustain:.8,release:0}},Ball_Spawn:{url:"sounds/Ball_Spawn.mp3",volume:"0.83",limit:0,ducking:{gain:.83,attack:.03,sustain:.1,release:.09}},Finish_It_Heartbeat_Loop:{url:"sounds/Finish_It_Heartbeat_Loop.mp3",volume:"0.82",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Finish_It_Hit:{url:"sounds/Finish_It_Hit.mp3",volume:"0.81",limit:0,ducking:{gain:.7,attack:.008,sustain:2.2,release:0}},Finish_It_Miss:{url:"sounds/Finish_It_Miss.mp3",volume:"0.7",limit:0,ducking:{gain:.65,attack:.02,sustain:.26,release:.14}},Powerup_Spin_Spin_Start:{url:"sounds/Powerup_Spin_Spin_Start.mp3",volume:"0.44",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Spin_Spin_Loop:{url:"sounds/Powerup_Spin_Spin_Loop.mp3",volume:"0.44",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}},Powerup_Spin_Startup:{url:"sounds/Powerup_Spin_Startup.mp3",volume:"0.47",limit:0,ducking:{gain:.8,attack:.03,sustain:.1,release:.25}},MenuMusic:{url:"music/MenuMusic1.mp3",volume:"0.22",limit:0,ducking:{gain:1,attack:0,sustain:0,release:0}}},banks:{dash:{limit:0,sounds:["Paddle_Dash_V1","Paddle_Dash_V2","Paddle_Dash_V3","Paddle_Dash_V4","Paddle_Dash_V5"],ducking:{gain:1,attack:0,sustain:0,release:0}},"spin-wall-bounce":{sounds:["Powerup_Spin_Wall_Bounce_V1","Powerup_Spin_Wall_Bounce_V2","Powerup_Spin_Wall_Bounce_V3","Powerup_Spin_Wall_Bounce_V4"],limit:0,ducking:{gain:.75,attack:.01,sustain:.06,release:.2}},"sticky-hit":{sounds:["Powerup_Sticky_Hit_V1","Powerup_Sticky_Hit_V2","Powerup_Sticky_Hit_V3","Powerup_Sticky_Hit_V4","Powerup_Sticky_Hit_V5","Powerup_Sticky_Hit_V6"],limit:170,ducking:{gain:.75,attack:.01,sustain:.06,release:.2}},score:{sounds:["Ball_Score_V1","Ball_Score_V2","Ball_Score_V3","Ball_Score_V4"],limit:0,ducking:{gain:.62,attack:.01,sustain:.06,release:.27}},"super-hard-shot":{sounds:["Power_Shot_V1","Power_Shot_V2","Power_Shot_V3","Power_Shot_V4"],limit:0,ducking:{gain:.47,attack:.003,sustain:.05,release:.33}},swish:{sounds:["Paddle_Spin_V1","Paddle_Spin_V2","Paddle_Spin_V3","Paddle_Spin_V4","Paddle_Spin_V5","Paddle_Spin_V6","Paddle_Spin_V7","Paddle_Spin_V8","Paddle_Spin_V9","Paddle_Spin_V10","Paddle_Spin_V11","Paddle_Spin_V12","Paddle_Spin_V13","Paddle_Spin_V14","Paddle_Spin_V15"],limit:0,ducking:{gain:.84,attack:.1,sustain:0,release:.1}},"mine-collision":{limit:170,sounds:["Bomb_Impact_Low_V1","Bomb_Impact_Low_V2","Bomb_Impact_Low_V3"],ducking:{gain:.7,attack:.006,sustain:0,release:.17}},"mine-explosion":{sounds:["Bomb_Explosion_V1","Bomb_Explosion_V2"],limit:0,ducking:{gain:.6,attack:.01,sustain:.06,release:.27}},"bones-collide":{sounds:["Powerup_Bones_Collision_Low_V1","Powerup_Bones_Collision_Low_V2","Powerup_Bones_Collision_Low_V3","Powerup_Bones_Collision_Low_V4","Powerup_Bones_Collision_Low_V5","Powerup_Bones_Collision_Low_V6","Powerup_Bones_Collision_Low_V7","Powerup_Bones_Collision_Low_V8","Powerup_Bones_Collision_Low_V9","Powerup_Bones_Collision_Low_V10","Powerup_Bones_Collision_Low_V11","Powerup_Bones_Collision_Low_V12","Powerup_Bones_Collision_Low_V13"],limit:0,ducking:{gain:.9,attack:.003,sustain:0,release:.04}},"ball-bounce-own-endzone":{sounds:["Ball_Bounce_OwnEndzone_V1","Ball_Bounce_OwnEndzone_V2","Ball_Bounce_OwnEndzone_V3"],limit:90,ducking:{gain:.77,attack:.003,sustain:0,release:.23}}},temporaryLowPass:{startFrequency:500,endFrequency:1e4,attack:0,sustain:1.666,release:1.666,Q:10}},music:{globalGainValue:.27000001072883606}};const gamepadInputLabels={standard:{buttons:{0:"actionDown",1:"actionRight",2:"actionLeft",3:"actionUp",4:"bumperLeft",5:"bumperRight",6:"triggerLeft",7:"triggerRight",8:"select",9:"start",10:"analogLeft",11:"analogRight",12:"dPadUp",13:"dPadDown",14:"dPadLeft",15:"dPadRight",16:"home"},axes:{0:"analogLeftX",1:"analogLeftY",2:"analogRightX",3:"analogRightY"}},xbox:{buttons:{0:"actionDown",1:"actionRight",2:"actionLeft",3:"actionUp",4:"bumperLeft",5:"bumperRight",6:"analogLeft",7:"analogLeft",8:"start",9:"select",10:"home",11:"dPadUp",12:"dPadDown",13:"dPadLeft",14:"dPadRight"},axes:{0:"analogLeftX",1:"analogLeftY",2:"triggerLeft",3:"analogRightX",4:"analogRightY",5:"triggerRight"}}},inverseGamepadInputLabels={};for(let e in gamepadInputLabels){let t=gamepadInputLabels[e],n=inverseGamepadInputLabels[e]={buttons:{},axes:{}};for(let e in t.buttons){let i=t.buttons[e];n.buttons[i]=parseInt(e)}for(let e in t.axes){let i=t.axes[e];n.axes[i]=parseInt(e)}}const keyboardInputLabelToActionMappings=[{KeyW:"up",KeyS:"down",KeyA:"left",KeyD:"right",KeyC:"spinCounterClockwise",KeyV:"spinClockwise",KeyF:"nudgeCounterClockwise",KeyG:"nudgeClockwise"},{ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",Comma:"spinCounterClockwise",Period:"spinClockwise",KeyJ:"nudgeCounterClockwise",KeyK:"nudgeClockwise"}],gamepadInputLabelToActionMapping={dPadUp:"up",dPadDown:"down",dPadLeft:"left",dPadRight:"right",bumperLeft:"spinCounterClockwise",bumperRight:"spinClockwise",triggerLeft:"nudgeCounterClockwise",triggerRight:"nudgeClockwise",analogLeftX:"moveX",analogLeftY:"moveY",analogRightX:"spinX",analogRightY:"spinY"};function loadSettings(){let e=JSON.parse(window.localStorage.getItem("settings"));if(e)for(var t in e)window.Settings[t]=e[t];else window.localStorage.setItem("settings",JSON.stringify(window.Settings))}window.Settings={playTo:2,clearSavedControlSettings:!0,showIntro:!1,debug:!0,availablePowerUpTypes:["mine","clone","grow","spin","magnet","noclip"],powerUpTypes:["mine","spin","grow"],brakesModeEnabled:!0,goalTimeoutMS:200,powerupFrequency:350,maxPowerupCount:2,mineForceRadius:175,mineForceMultiplier:75e-5,showFrameRate:!1,showBackground:!0,sounds:!0,music:!0,player1Control:"player",player2Control:"AI",aiStupidity1:.2,aiStupidity2:.2,gamesStarted:0,gamesFinished:0},loadSettings();var queryStringParts=window.location.search.substr(1).split("&");queryStringParts.forEach(function(e){var t=e.split("="),n=t[0],i=t[1];try{i=JSON.parse(unescape(i))}catch(e){}"false"===i&&(i=!1),"true"===i&&(i=!0),n in window.Settings&&(window.Settings[n]=i)}),function(){const e={};let t=null;window.ScreenManager={initScreens:()=>{for(let t in e)e[t].element=document.querySelector(".screen."+t),e[t].init&&e[t].init(e[t])},addScreen:(t,n)=>{console.log("Adding screen",t),e[t]=n},transitionToScreen:n=>(gtag("event",n+" loaded",{event_category:"Page Loaded"}),new Promise((i,o)=>{if(!e[n])throw new Error('No screen with name "'+n+'".');{function s(){t&&t.element.classList.remove("show"),(t=e[n]).element.classList.add("show"),t.start?t.start().then(()=>{i()}):i()}t&&t.stop?t.stop().then(s):s()}}))},document.addEventListener("DOMContentLoaded",t=>{ScreenManager.addScreen("loading",{stop:()=>new Promise((t,n)=>{e.loading.element.querySelector(".loading-modal").classList.add("hide-loading"),setTimeout(t,1e3)})}),ScreenManager.initScreens(),ScreenManager.transitionToScreen("loading").then(()=>{SoundManager.init({dontWorryAboutWebAudioAutoplayPolicy:!0,progress:function(t,n){e.loading.element.querySelector(".loading-modal .percent").textContent=Math.floor(n/t*100)+"%"}}).then(()=>{let t=document.location.search.substr(1).match(/screen=(.+)/);t=t?t[1]:"story",ScreenManager.transitionToScreen(t).then(()=>{e.loading.element.querySelector(".loading-modal").classList.add("hide-loading")})})})})}(),document.addEventListener("DOMContentLoaded",e=>{window.Debug={playerScoreBig:function(e){game.balls.forEach(t=>{t.lastTouchedPaddle=e}),game.playerScored(e,{id:game.balls[0].physics.id,position:{x:game.balls[0].physics.position.x,y:game.balls[0].physics.position.y},velocity:{x:-100,y:-100}})},player1ScoreBig:function(){Debug.playerScoreBig(1)},player2ScoreBig:function(){Debug.playerScoreBig(0)},player1Powerup:function(e){game.paddles[0].powerup(e)},player2Powerup:function(e){game.paddles[1].powerup(e)},player1Win:function(){game.score.winner=game.paddles[0],game.score.loser=game.paddles[1],game.score.player1=game.score.max-1,game.score.player2=game.score.max-2,game.gameOver()},player2Win:function(){game.score.winner=game.paddles[1],game.score.loser=game.paddles[0],game.score.player2=game.score.max-1,game.score.player1=game.score.max-2,game.gameOver()},fireGun:function(){fireGun(250,250,0,1)}},Settings.powerUpTypes.forEach(e=>{Debug["player1Powerup_"+e]=function(){Debug.player1Powerup(e)},Debug["player2Powerup_"+e]=function(){Debug.player2Powerup(e)}})});var particles=[],blankParticles=[];function initParticleEngine(e,t){for(t=t||50;particles.length;)particles.shift().dismantle();blankParticles=[];for(var n=0;n<t;n++){var i=document.createElement("div");i.classList.add("blank-particle"),document.querySelector(e).appendChild(i),blankParticles.push({active:!1,el:i})}console.log("INITIALIZING PARTICLE ENGINE ON "+e+" with "+blankParticles.length+" BLANK PARTICLES")}function makeParticle(e){var t={x:e.x||0,xV:e.xV||0,xVa:e.xVa||0,maxX:e.maxX||!1,minX:e.minX||!1,y:e.y||0,yV:e.yV||0,yVa:e.yVa||0,maxY:e.maxY||!1,minY:e.minY||!1,z:e.z||0,zV:e.zV||0,xR:e.xR||0,xRv:e.xRv||0,yR:e.yR||0,yRv:e.yRv||0,zR:e.zR||0,zRv:e.zRv||0,o:e.o||1,oV:e.oV||0,scale:e.scale||1,scaleV:e.scaleV||0,scaleVa:e.scaleVa||0,text:e.text||!1,speed:e.speed||!1,speedA:e.speedA||0,angle:e.angle||!1,color:e.color||!1,width:e.width||20,height:e.height||20,gravity:e.gravity||0,className:e.className||!1,classList:e.classList||[],lifespan:e.lifespan||200,delay:e.delay||0};t.angle&&(t.angle=t.angle-180,t.xV=Math.sin(t.angle*(Math.PI/180))*t.speed,t.yV=Math.cos(t.angle*(Math.PI/180))*t.speed,t.xVa=Math.sin(t.angle*(Math.PI/180))*t.speedA,t.yVa=Math.cos(t.angle*(Math.PI/180))*t.speedA);for(var n=0;n<blankParticles.length;n++){var i=blankParticles[n];if(0==i.active){i.active=!0,t.referenceParticle=i,t.el=i.el;break}}if(t.el){t.referenceParticle=i,t.el.style.height=t.height+"px",t.el.style.width=t.width+"px",t.el.classList.add(t.className);for(n=0;n<t.classList.length;n++)t.el.classList.add(t.classList[n]);t.el.style.background=t.color,t.text&&(t.el.innerText=e.text),t.dismantle=function(){this.referenceParticle.active=!1,this.el.removeAttribute("style"),this.el.removeAttribute("class"),this.el.classList.add("blank-particle"),this.el.style.display="none",this.el.innerText="";for(var e=0;e<particles.length;e++)this==particles[e]&&particles.splice(e,1)},t.move=function(){var e=this;e.delay>0?e.delay--:(e.lifespan--,(e.lifespan<0||e.o<0)&&t.dismantle(),e.x=e.x+e.xV,e.y=e.y+e.yV,e.xV=e.xV+e.xVa,e.yV=e.yV+e.yVa,e.xV<0&&(e.x,e.minX),e.xV<0&&(e.x,e.minX),e.xV>0&&(e.x,e.maxX),e.o=e.o+e.oV,e.o<=0&&e.oV<=0&&(e.lifespan=0),e.xV<0&&e.xVa<0?(e.xVa=0,e.xV=0):e.xV>0&&e.xVa>0&&(e.xVa=0,e.xV=0),e.yV<0&&e.yVa<0?(e.yVa=0,e.yV=0):e.yV>0&&e.yVa>0&&(e.yVa=0,e.yV=0),e.scale<=0&&e.scaleV<=0&&(e.lifespan=0),e.z=e.z+e.zV,e.zV=e.zV-e.gravity,e.scale=e.scale+e.scaleV,e.scaleV=e.scaleV+e.scaleVa,e.xR=e.xR+e.xRv,e.zR=e.zR+e.zRv,e.yR=e.yR+e.yRv,e.el.style.transform="translate3d("+e.x+"px,"+e.y+"px,"+e.z+"px) rotateX("+e.xR+"deg) rotateZ("+e.zR+"deg) rotateY("+e.yR+"deg) scale("+e.scale+")",e.el.style.opacity=e.o)},particles.push(t),t.el.style.display="block",t.el.style.opacity=0}}function drawParticles(){for(var e=0;e<particles.length;e++){particles[e].move()}}function startParticleLoop(){let e=!1;return function t(){drawParticles(),e||requestAnimationFrame(t)}(),{stop:()=>{e=!0}}}function getRandom(e,t){return e+Math.random()*(t-e)}function constrain(e,t,n){return e<=t?t:e>=n?n:e}function mapScale(e,t,n,i,o){return e>=n?e=n:e<=t&&(e=t),i+(o-i)*((e-t)/(n-t))}let canvas,ctx,canvasHeight,canvasWidth,effectsElements={};function initEffects(){effectsElements.body=document.querySelector("body"),effectsElements.world=document.querySelector(".world"),effectsElements.blastZone=document.querySelector(".blast-zone"),effectsElements.shakeWrapper=document.querySelector(".shake-wrapper"),effectsElements.scene=document.querySelector(".scene"),BallTrailManager.startBallTrail()}function powerupScored(e,t,n){for(var i=0;i<4;i++){var o={x:e,y:t-15,width:20,height:20,speed:getRandom(3,5),speedA:-.075,scaleV:-.02,classList:["powerup-scored-particle",n],lifespan:125};e>450?(o.angle=getRandom(20,160),o.x=o.x+10):(o.angle=getRandom(200,340),o.x=o.x-20),makeParticle(o)}(o={x:0,y:t,width:20,height:200,classList:["powerup-scored-beam",n],lifespan:40}).x=e>450?850:-20,makeParticle(o);var s=document.createElement("div");s.classList.add("powerup-scored"),e<445?s.classList.add("left"):s.classList.add("right"),s.classList.add(n||"grow"),effectsElements.world.appendChild(s),setTimeout(function(e){return function(){e.remove()}}(s),500)}function mineExplosion(e,t,n){shakeScreen();var i=n/2,o=e-i,s=t-i,a={};a.el=document.createElement("div"),a.el.classList.add("boom"),a.el.classList.add("round");var r=document.createElement("div");r.classList.add("shock"),a.el.classList.add("round");var l,u=document.createElement("div");u.classList.add("body"),a.el.appendChild(r),a.el.appendChild(u),a.el.style.height=n+"px",a.el.style.width=n+"px",a.el.style.transform="translate3d("+o+"px,"+s+"px,0)",setTimeout((l=a.el,function(){l.remove()}),500),effectsElements.world.appendChild(a.el),SoundManager.fireEvent("Mine_Explosion")}function makeCracks(e,t){var n,i=document.createElement("div"),o=getRandom(200,300);i.classList.add("cracks"),i.style.width=o+"px",i.style.height=o+"px",i.style.transform="translate3d("+(e-o/2)+"px, "+(t-o/2)+"px , 0) rotate("+getRandom(0,360)+"deg)",effectsElements.blastZone.appendChild(i),setTimeout((n=i,function(){n.remove()}),1500)}function makeExplosion(e,t,n,i,o){makeCracks(e,t),i||(i="all"),shakeScreen();var s,a=n/2,r=e-a,l=t-a,u={};u.el=document.createElement("div"),u.el.classList.add("boom"),u.el.innerHTML='<div class="shock"></div><div class="body"></div>',u.el.style.height=n+"px",u.el.style.width=n+"px",u.el.style.transform="translate3d("+r+"px,"+l+"px,0)",setTimeout((s=u.el,function(){s.remove()}),500),effectsElements.world.appendChild(u.el)}function shakeScreen(){let e=40,t=[],n=Math.random()>=.5?1:-1;for(var i=0;i<4;i++){let i={transform:`\n        translateX(${n*getRandom(.5*e,e)}px)\n        rotate(${n*getRandom(1,2)}deg)`};n*=-1,e*=.75,e=1.5,t.push(i)}t.push({transform:"rotate(0) translateX(0) translateY(0)"}),effectsElements.shakeWrapper.animate(t,{duration:300,easing:"ease-out"})}function addTemporaryClassName(e,t,n){e.classList.remove(t),setTimeout(function(){e.classList.add(t)},1),setTimeout(function(){e.classList.remove(t)},n||1e3)}function addBallTrail(e,t){makeParticle({x:e-15,y:t-15,width:30,oV:-.02,scaleV:-.01,height:30,className:"spinSquare",lifespan:125})}function fireGun(e,t,n,i){makeParticle({x:e-50,y:t-240,zR:180-n,width:100,height:240,oV:-.05,className:"fire"}),makeParticle({x:e-30,y:t-100,zR:-n,width:60,height:100,oV:-.05,className:"back-fire"});addTemporaryClassName(effectsElements.body,"team-1-scored-flash",500),shakeScreen(),SoundManager.fireEvent("Super_Hard_Shot"),document.dispatchEvent(new CustomEvent("emotion",{detail:{player:i,type:"strong"}}))}function drawLetter(e,t,n,i){makeParticle({x:e-15,y:t-15,o:6,oV:-.1,height:30,width:30,scaleV:-.002,zR:n-90,lifespan:100,className:"speedLetter",text:i})}function popPaddle(e){for(var t=0;t<5;t++){makeParticle({x:getRandom(e.bounds.min.x,e.bounds.max.x)-5,y:getRandom(e.bounds.min.y,e.bounds.max.y)-5,zR:0,zRv:0,height:10,width:10,o:1,oV:-.03,lifespan:500,speed:getRandom(4,6),speedA:-.1,angle:1+360*t/5,className:"paddleChunk"})}}function popBall(e){for(var t=0;t<5;t++){makeParticle({x:e.position.x,y:e.position.y,zR:0,zRv:0,height:10,width:10,o:1,oV:-.02,lifespan:500,speed:4,speedA:-.1,angle:1+360*t/5,className:"ballCloneChunk"})}}function addFakeBall(e){var t="right",n=game.boardWidth,i="pink";e.position.x<game.boardWidth/2&&(t="left",n=-20,i="green");var o=-(180*Math.atan2(e.velocity.x,e.velocity.y)/Math.PI+180);o<0&&(o+=360),makeParticle(a={x:e.position.x-15,y:e.position.y-15,height:30,width:30,lifespan:2e4,angle:o,speed:2*e.speed,className:"fake-ball"});for(var s=0;s<5;s++){makeParticle(a={x:n,y:e.position.y-15+getRandom(-20,20),height:20,width:20,lifespan:2e4,angle:o+getRandom(-25,25),speed:e.speed+getRandom(-2,2),className:"boardChunk"})}makeParticle(a={x:n,y:e.position.y-30,width:20,height:60,lifespan:120,className:i+"Patch"});var a={x:n,y:e.position.y-50,width:120,height:40,lifespan:120,className:i+"Shrapnel",zR:180-(o-90)-10};"left"==t&&(a.x=-120,a.zR=a.zR-180+20),makeParticle(a);a={x:n,y:e.position.y+10,width:120,height:40,lifespan:120,className:i+"Shrapnel",zR:180-(o-90)+10};"left"==t&&(a.x=-120,a.zR=a.zR-180-20),makeParticle(a)}function explodePaddle(e){for(var t=0;t<15;t++){makeParticle({x:getRandom(e.bounds.min.x,e.bounds.max.x),y:getRandom(e.bounds.min.y,e.bounds.max.y),zR:getRandom(-5,5),zRv:getRandom(-5,5),scaleV:-.005,height:20,width:20,lifespan:100,xV:getRandom(-5,5),yV:getRandom(-5,5),className:"paddleChunk"})}makeExplosion(e.position.x,e.position.y,75),shakeScreen()}function showMessage(e){var t=document.createElement("div");t.classList.add("message");var n,i=document.createElement("div");i.classList.add("body"),i.innerText=e.text,i.style.fontSize=e.fontSize+"px",t.appendChild(i),t.style.transform="translateX("+e.x+"px) translateY("+e.y+"px)",effectsElements.world.appendChild(t),setTimeout((n=t,function(){n.remove()}),e.timeout)}function makeTerrainChunks(e,t,n,i,o){for(var s=0;s<10;s++){var a={zR:getRandom(-5,5),scaleV:-.02,height:getRandom(25,65),lifespan:100,xV:getRandom(15*t,20*t),minX:0};a.maxX=i-a.height,a.x=e/100*i-t*a.height,a.xV=a.xV-a.height/65*a.xV*.5,a.xVa=-a.xV/40,a.y=getRandom(0,o-a.height),a.className=n,a.width=a.height,a.x=a.x-a.width/2,makeParticle(a)}}function buttonGleam(e){let t=document.createElement("div");t.classList.add("gleam"),e.appendChild(t);let n={duration:mapScale(e.getBoundingClientRect().width,50,180,300,350),easing:"ease-in-out"};t.animate([{transform:"scaleX(0)",transformOrigin:"left",opacity:.4,offet:0},{transform:"scaleX(1)",transformOrigin:"left",opacity:.5,offset:.3},{transformOrigin:"right",transform:"scaleX(1)",opacity:.5,offset:.7},{opacity:.4,transform:"scaleX(0)",transformOrigin:"right",offset:1}],n).onfinish=function(e){t.remove()}}function addChangeAnim(e){e.animate([{transform:"scale(.6)",offet:0},{transform:"scale(1.1)",offset:.3},{transform:"scale(1)",offset:1}],{duration:300,easing:"ease-in-out"})}let stars=[],starsRadiusModifier=0,maxStarsRadiusModifier=1,useGameTerrain=!1,starsStarted=!1;function drawStars(){(starsRadiusModifier*=.9)<0&&(starsRadiusModifier=0),ctx.globalCompositeOperation="destination-over",ctx.clearRect(0,0,canvasWidth,canvasHeight);var e=.5;if(useGameTerrain){e=(-50+(game.terrainLinePercent||50))/50}for(var t=0;t<stars.length;t++){let n=stars[t];ctx.beginPath(),ctx.fillStyle="rgba(255, 255, 255, "+(n.opacity+.15*starsRadiusModifier)+")",ctx.arc(n.x,n.y,n.radius+starsRadiusModifier*n.radius,0,2*Math.PI,!1),ctx.fill(),n.x=n.x+e*n.speed,0===e&&(n.y=n.y+n.speed/40),n.x>canvasWidth+100?n.x=0:n.x<-100&&(n.x=canvasWidth),n.y>canvasHeight&&(n.y=0)}window.requestAnimationFrame(drawStars)}function startStars(e,t,n,i,o){stars=[],canvas=document.querySelector(e+" .canvas-stars canvas"),useGameTerrain=o,resizeStarsCanvas(),ctx=canvas.getContext("2d"),makeStars(t),window.addEventListener("resize",()=>{resizeStarsCanvas()}),0==starsStarted&&(starsStarted=!0,drawStars())}function resizeStarsCanvas(){canvasWidth=canvas.width=window.innerWidth,canvasHeight=canvas.height=window.innerHeight,stars.forEach(function(e){e.y=getRandom(0,canvasHeight)})}function makeStars(e){for(var t=0;t<e;t++)stars.push({x:getRandom(0,canvasWidth),y:getRandom(0,canvasHeight),radius:getRandom(2,3),opacity:getRandom(.1,.5),speed:getRandom(5,20)})}!function(){const e=.2,t=.4,n=.9,i={left:{active:10},right:{active:10},down:{active:10},up:{active:10},spinCounterClockwise:{active:50},spinClockwise:{active:50}},o=Math.PI/2,s=["running","finish"];function a(){let e={};this.update=function(t){let n=Date.now();Object.keys(e).forEach(o=>{i[o]&&n-e[o].lastFire>i[o].active&&delete e[o],t[o]=1})},this.check=function(t){return t in e},this.fire=function(t){let n=Date.now();e[t]=e[t]||{lastFire:n}}}function r(e,t,n){let i=t.x,o=n.x,s=t.y,a=n.y,r=s-a,l=o-i,u=i*a-o*s;return Math.abs(r*e.x+l*e.y+u)/Math.sqrt(r*r+l*l)}window.AIManager=function(i,l){let u=null,c=[];this.createPaddleAIInputComponent=function(l,d){console.log("%cInitializing AI Input Component","color: yellow");document.querySelector("#aidebug ."+d);const p="left"===d?1:-1,m=-10*p,h=15,g="left"===d?"right":"left",y="left"===d?"spinClockwise":"spinCounterClockwise",_="left"===d?"spinCounterClockwise":"spinClockwise",f="left"===d?i.boardWidth/4:3*i.boardWidth/4,w=l.physics,S=Math.sqrt((w.vertices[1].x-w.vertices[2].x)*(w.vertices[1].x-w.vertices[2].x)+(w.vertices[1].y-w.vertices[2].y)*(w.vertices[1].y-w.vertices[2].y));let v=Settings["aiStupidity"+("left"===d?1:2)],P=new a,b="getCloseToBall",M=null,k=null,L=0,V=25;function B(e){M=e,k=e.physics.position,V=Math.sqrt(e.physics.area)-2}function x(){return Math.random()<=v}const T={recognizeTargets:()=>{let o=Date.now();if(!0!==M.destroyed&&(Math.random()<.4||o-L<1500))return;let s=[],a=0;function r(e,t){a+=t,s.push({object:e,a:a-t,b:a})}i.powerupManager.activePowerups.forEach(e=>{"left"===d?e.physics.position.x<i.boardWidth*i.terrainLinePercent/100&&("mine"===e.type?r(e,n):r(e,t)):e.physics.position.x>i.boardWidth*i.terrainLinePercent/100&&("mine"===e.type?r(e,n):r(e,t))}),i.balls.forEach(t=>{r(t,e)});let l=Math.random()*a;for(let e=0;e<s.length;++e)if(l>=s[e].a&&l<=s[e].b){B(s[e].object);break}L=o},swingAtTarget:()=>{if(x())return;let e=r(k,w.vertices[1],w.vertices[2]),t=r(k,w.vertices[0],w.vertices[3]);if(Math.min(e,t)<V){if("left"===d&&M.type&&"mine"!==M.type&&k.x<w.position.x&&Math.random()<.75)return;if("right"===d&&M.type&&"mine"!==M.type&&k.x>w.position.x&&Math.random()<.5)return;P.check("up")&&P.fire(y),P.check("down")&&P.fire(_)}},pursueTargetX:()=>{let e=k.x+m,t=(w.position.x-e)*p,n=Math.abs(w.position.x-i.boardWidth*i.terrainLinePercent/100);t>0?P.fire(d):(n>10||"ghost"!==l.mode)&&P.fire(g)},pursueTargetY:()=>{w.position.y<k.y&&P.fire("down"),w.position.y>k.y&&P.fire("up")}},E={waitForGameToResume:e=>{s.indexOf(i.mode)>-1&&(b="getCloseToBall")},getCloseToBall:e=>{if(x())return;T.recognizeTargets(),T.pursueTargetY(),T.pursueTargetX(),Math.sqrt((w.position.x-k.x)*(w.position.x-k.x)+(w.position.y-k.y)*(w.position.y-k.y))<S?T.swingAtTarget():T.straightenUp()}};"left"===d?(T.straightenUp=(()=>{let e=Math.abs(l.targetAngle%Math.PI);Math.abs(e-o)<.001&&P.fire("spinClockwise")}),T.moveToTerrainCenter=(()=>{let e=w.position.x,t=w.position.y;t<i.boardHeight/2-h&&P.fire("down"),t>i.boardHeight/2+h&&P.fire("up");let n=Math.abs(e-f);e>f&&n>50?P.fire("left"):e<f&&n>50&&P.fire("right")}),E.getReadyForNextRound=(e=>{"roundover"===i.mode?(T.moveToTerrainCenter(),T.straightenUp()):b="getCloseToBall"})):(T.straightenUp=(()=>{let e=Math.abs(l.targetAngle%Math.PI);Math.abs(e-o)<.001&&P.fire("spinCounterClockwise")}),E.getReadyForNextRound=(e=>{let t=w.position.x,n=w.position.y;if("roundover"===i.mode){n<i.boardHeight/2-h&&P.fire("down"),n>i.boardHeight/2+h&&P.fire("up");let e=Math.abs(t-f);t<f&&e>50?P.fire("right"):t>f&&e>50&&P.fire("left"),T.straightenUp()}else b="getCloseToBall"}));let C={actions:{},setTarget:B,update:function(){let e={};return M&&u?("roundover"===i.mode?b="getReadyForNextRound":-1===s.indexOf(i.mode)&&(b="waitForGameToResume"),E[b](e),P.update(e),e):e},register:function(e){this.actions=e},remove:function(){console.log("%cDestroying AI Input Component","color: yellow")}};return c.push(C),C},this.setBall=(e=>{u=e.physics,c.forEach(t=>t.setTarget(e))})}}();var position=0,pongLength=6,direction="up";setInterval(function(){var e="|";"up"==direction?position++:position--,position<1&&(direction="up"),position>pongLength&&(direction="down");for(var t=0;t<=pongLength+1;t++)e+=t==position?"•":" ";e+="|",document.title=e},250),function(){const e={startFrequency:500,endFrequency:1e4,attack:0,sustain:1.666,release:1.666,Q:10};let t={Text_Type_1:{url:"sounds/Text_Type.mp3",volume:1},Text_Type_2:{url:"sounds/Text_Type_2.mp3",volume:1},"round-start":{url:"sounds/round-start.mp3",volume:.25},beep:{url:"sounds/beep.mp3",volume:.15},Power_Shot_V1:{url:"sounds/Power_Shot_V1.mp3",volume:1},Power_Shot_V2:{url:"sounds/Power_Shot_V2.mp3",volume:1},Power_Shot_V3:{url:"sounds/Power_Shot_V3.mp3",volume:1},Power_Shot_V4:{url:"sounds/Power_Shot_V4.mp3",volume:1},Ball_Score_V1:{url:"sounds/Ball_Score_V1.mp3",volume:1},Ball_Score_V2:{url:"sounds/Ball_Score_V2.mp3",volume:1},Ball_Score_V3:{url:"sounds/Ball_Score_V3.mp3",volume:1},Ball_Score_V4:{url:"sounds/Ball_Score_V4.mp3",volume:1},Bomb_Impact_Low_V1:{url:"sounds/Bomb_Impact_Low_V1.mp3",volume:1},Bomb_Impact_Low_V2:{url:"sounds/Bomb_Impact_Low_V2.mp3",volume:1},Bomb_Impact_Low_V3:{url:"sounds/Bomb_Impact_Low_V3.mp3",volume:1},Ball_Bounce_Paddle:{url:"sounds/Ball_Bounce_Paddle 1.2.mp3",volume:1,limit:100},Ball_Bounce_Wall:{url:"sounds/Ball_Bounce_Wall 1.2.mp3",volume:1,limit:100},Ball_Bounce_OwnEndzone_V1:{url:"sounds/Ball_Bounce_OwnEndzone_V1.mp3",volume:1},Ball_Bounce_OwnEndzone_V2:{url:"sounds/Ball_Bounce_OwnEndzone_V2.mp3",volume:1},Ball_Bounce_OwnEndzone_V3:{url:"sounds/Ball_Bounce_OwnEndzone_V3.mp3",volume:1},Powerup_Bones_Disapear_1:{url:"sounds/Powerup_Bones_Disapear_1.mp3",volume:1},Powerup_Bones_Disapear_2:{url:"sounds/Powerup_Bones_Disapear_2.mp3",volume:1},Powerup_Bones_Disapear_3:{url:"sounds/Powerup_Bones_Disapear_3.mp3",volume:1},Powerup_Bones_Disapear_4:{url:"sounds/Powerup_Bones_Disapear_4.mp3",volume:1},Powerup_Bones_Disapear_5:{url:"sounds/Powerup_Bones_Disapear_5.mp3",volume:1},Powerup_Bones_Disapear_6:{url:"sounds/Powerup_Bones_Disapear_6.mp3",volume:1},Powerup_Bones_Collision_Low_V1:{url:"sounds/Powerup_Bones_Collision_Low_V1.mp3",volume:1},Powerup_Bones_Collision_Low_V2:{url:"sounds/Powerup_Bones_Collision_Low_V2.mp3",volume:1},Powerup_Bones_Collision_Low_V3:{url:"sounds/Powerup_Bones_Collision_Low_V3.mp3",volume:1},Powerup_Bones_Collision_Low_V4:{url:"sounds/Powerup_Bones_Collision_Low_V4.mp3",volume:1},Powerup_Bones_Collision_Low_V5:{url:"sounds/Powerup_Bones_Collision_Low_V5.mp3",volume:1},Powerup_Bones_Collision_Low_V6:{url:"sounds/Powerup_Bones_Collision_Low_V6.mp3",volume:1},Powerup_Bones_Collision_Low_V7:{url:"sounds/Powerup_Bones_Collision_Low_V7.mp3",volume:1},Powerup_Bones_Collision_Low_V8:{url:"sounds/Powerup_Bones_Collision_Low_V8.mp3",volume:1},Powerup_Bones_Collision_Low_V9:{url:"sounds/Powerup_Bones_Collision_Low_V9.mp3",volume:1},Powerup_Bones_Collision_Low_V10:{url:"sounds/Powerup_Bones_Collision_Low_V10.mp3",volume:1},Powerup_Bones_Collision_Low_V11:{url:"sounds/Powerup_Bones_Collision_Low_V11.mp3",volume:1},Powerup_Bones_Collision_Low_V12:{url:"sounds/Powerup_Bones_Collision_Low_V12.mp3",volume:1},Powerup_Bones_Collision_Low_V13:{url:"sounds/Powerup_Bones_Collision_Low_V13.mp3",volume:1},Powerup_Bones_Deselect:{url:"sounds/Powerup_Bones_Deselect.mp3",volume:1},Powerup_Bones_Score:{url:"sounds/Powerup_Bones_Score.mp3",volume:1},Powerup_Enhance_Score:{url:"sounds/Powerup_Enhance_Score.mp3",volume:1},Powerup_Spin_Score:{url:"sounds/Powerup_Spin_Score.mp3",volume:1},Powerup_Ghost_Score:{url:"sounds/Powerup_Ghost_Score.mp3",volume:1},Powerup_Ghost_WareOff:{url:"sounds/Powerup_Ghost_WareOff.mp3",volume:1},Powerup_Sticky_Score:{url:"sounds/Powerup_Sticky_Score.mp3",volume:1},Powerup_Sticky_WareOff:{url:"sounds/Powerup_Sticky_WareOff.mp3",volume:1},Powerup_Sticky_Hit_V1:{url:"sounds/Powerup_Sticky_Hit_V1.mp3",volume:1},Powerup_Sticky_Hit_V2:{url:"sounds/Powerup_Sticky_Hit_V2.mp3",volume:1},Powerup_Sticky_Hit_V3:{url:"sounds/Powerup_Sticky_Hit_V3.mp3",volume:1},Powerup_Sticky_Hit_V4:{url:"sounds/Powerup_Sticky_Hit_V4.mp3",volume:1},Powerup_Sticky_Hit_V5:{url:"sounds/Powerup_Sticky_Hit_V5.mp3",volume:1},Powerup_Sticky_Hit_V6:{url:"sounds/Powerup_Sticky_Hit_V6.mp3",volume:1},Powerup_Spin_Wall_Bounce_V1:{url:"sounds/Powerup_Spin_Wall_Bounce_V1.mp3",volume:1},Powerup_Spin_Wall_Bounce_V2:{url:"sounds/Powerup_Spin_Wall_Bounce_V2.mp3",volume:1},Powerup_Spin_Wall_Bounce_V3:{url:"sounds/Powerup_Spin_Wall_Bounce_V3.mp3",volume:1},Powerup_Spin_Wall_Bounce_V4:{url:"sounds/Powerup_Spin_Wall_Bounce_V4.mp3",volume:1},Powerup_Enhance_WareOff:{url:"sounds/Powerup_Enhance_WareOff.mp3",volume:1},Powerup_Spin_WareOff:{url:"sounds/Powerup_Spin_WareOff.mp3",volume:1},Bomb_Explosion_V1:{url:"sounds/Bomb_Explosion_V1.mp3",volume:1},Bomb_Explosion_V2:{url:"sounds/Bomb_Explosion_V2.mp3",volume:1},Paddle_Spin_V1:{url:"sounds/Paddle_Spin_V1.mp3",volume:1},Paddle_Spin_V2:{url:"sounds/Paddle_Spin_V2.mp3",volume:1},Paddle_Spin_V3:{url:"sounds/Paddle_Spin_V3.mp3",volume:1},Paddle_Spin_V4:{url:"sounds/Paddle_Spin_V4.mp3",volume:1},Paddle_Spin_V5:{url:"sounds/Paddle_Spin_V5.mp3",volume:1},Paddle_Spin_V6:{url:"sounds/Paddle_Spin_V6.mp3",volume:1},Paddle_Spin_V7:{url:"sounds/Paddle_Spin_V7.mp3",volume:1},Paddle_Spin_V8:{url:"sounds/Paddle_Spin_V8.mp3",volume:1},Paddle_Spin_V9:{url:"sounds/Paddle_Spin_V9.mp3",volume:1},Paddle_Spin_V10:{url:"sounds/Paddle_Spin_V10.mp3",volume:1},Paddle_Spin_V11:{url:"sounds/Paddle_Spin_V11.mp3",volume:1},Paddle_Spin_V12:{url:"sounds/Paddle_Spin_V12.mp3",volume:1},Paddle_Spin_V13:{url:"sounds/Paddle_Spin_V13.mp3",volume:1},Paddle_Spin_V14:{url:"sounds/Paddle_Spin_V14.mp3",volume:1},Paddle_Spin_V15:{url:"sounds/Paddle_Spin_V15.mp3",volume:1},Paddle_Dash_V1:{url:"sounds/Paddle_Dash_V1.mp3",volume:1},Paddle_Dash_V2:{url:"sounds/Paddle_Dash_V2.mp3",volume:1},Paddle_Dash_V3:{url:"sounds/Paddle_Dash_V3.mp3",volume:1},Paddle_Dash_V4:{url:"sounds/Paddle_Dash_V4.mp3",volume:1},Paddle_Dash_V5:{url:"sounds/Paddle_Dash_V5.mp3",volume:1},Powerup_Spawn:{url:"sounds/Powerup_Spawn.mp3",volume:1},Bomb_Spawn:{url:"sounds/Bomb_Spawn.mp3",volume:1},Bomb_Disable:{url:"sounds/Bomb_Disable.mp3",volume:1},Menu_Move:{url:"sounds/Menu_Move.mp3",volume:1},Menu_Select:{url:"sounds/Menu_Select.mp3",volume:1},"Menu_Start&Blastoff":{url:"sounds/Menu_Start&Blastoff.mp3",volume:1},Powerup_Bounce_Paddle:{url:"sounds/Powerup_Bounce_Paddle.mp3",volume:1,limit:100},Powerup_Bounce_Wall:{url:"sounds/Powerup_Bounce_Wall.mp3",volume:1,limit:100},Win_Cheer:{url:"sounds/Win_Cheer.mp3",volume:1},Ball_Spawn:{url:"sounds/Ball_Spawn.mp3",volume:1},Finish_It_Heartbeat_Loop:{url:"sounds/Finish_It_Heartbeat_Loop.mp3",volume:1},Finish_It_Hit:{url:"sounds/Finish_It_Hit.mp3",volume:1},Finish_It_Miss:{url:"sounds/Finish_It_Miss.mp3",volume:1},Powerup_Spin_Spin_Start:{url:"sounds/Powerup_Spin_Spin_Start.mp3",volume:1},Powerup_Spin_Spin_Loop:{url:"sounds/Powerup_Spin_Spin_Loop.mp3",volume:1},Powerup_Spin_Startup:{url:"sounds/Powerup_Spin_Startup.mp3",volume:1}},n={dash:{limit:0,sounds:["Paddle_Dash_V1","Paddle_Dash_V2","Paddle_Dash_V3","Paddle_Dash_V4","Paddle_Dash_V5"]},"spin-wall-bounce":{sounds:["Powerup_Spin_Wall_Bounce_V1","Powerup_Spin_Wall_Bounce_V2","Powerup_Spin_Wall_Bounce_V3","Powerup_Spin_Wall_Bounce_V4"]},"sticky-hit":{sounds:["Powerup_Sticky_Hit_V1","Powerup_Sticky_Hit_V2","Powerup_Sticky_Hit_V3","Powerup_Sticky_Hit_V4","Powerup_Sticky_Hit_V5","Powerup_Sticky_Hit_V6"]},score:{sounds:["Ball_Score_V1","Ball_Score_V2","Ball_Score_V3","Ball_Score_V4"]},"super-hard-shot":{sounds:["Power_Shot_V1","Power_Shot_V2","Power_Shot_V3","Power_Shot_V4"]},swish:{sounds:["Paddle_Spin_V1","Paddle_Spin_V2","Paddle_Spin_V3","Paddle_Spin_V4","Paddle_Spin_V5","Paddle_Spin_V6","Paddle_Spin_V7","Paddle_Spin_V8","Paddle_Spin_V9","Paddle_Spin_V10","Paddle_Spin_V11","Paddle_Spin_V12","Paddle_Spin_V13","Paddle_Spin_V14","Paddle_Spin_V15"]},"mine-collision":{limit:100,sounds:["Bomb_Impact_Low_V1","Bomb_Impact_Low_V2","Bomb_Impact_Low_V3"]},"mine-explosion":{sounds:["Bomb_Explosion_V1","Bomb_Explosion_V2"]},"bones-collide":{sounds:["Powerup_Bones_Collision_Low_V1","Powerup_Bones_Collision_Low_V2","Powerup_Bones_Collision_Low_V3","Powerup_Bones_Collision_Low_V4","Powerup_Bones_Collision_Low_V5","Powerup_Bones_Collision_Low_V6","Powerup_Bones_Collision_Low_V7","Powerup_Bones_Collision_Low_V8","Powerup_Bones_Collision_Low_V9","Powerup_Bones_Collision_Low_V10","Powerup_Bones_Collision_Low_V11","Powerup_Bones_Collision_Low_V12","Powerup_Bones_Collision_Low_V13"]},"ball-bounce-own-endzone":{sounds:["Ball_Bounce_OwnEndzone_V1","Ball_Bounce_OwnEndzone_V2","Ball_Bounce_OwnEndzone_V3"]},type:{sounds:["Text_Type_1","Text_Type_2"]}},i={Finish_It_Heartbeat:{sound:"Finish_It_Heartbeat_Loop"},Powerup_Spin_Spin:{sound:"Powerup_Spin_Spin_Loop"}},o={Ghost_Enters_Paddle_Enemy_Territory:()=>{},Ghost_Leaves_Paddle_Enemy_Territory:()=>{},Super_Hard_Shot:()=>{SoundManager.playRandomSoundFromBank("super-hard-shot"),l.addIntensity(15)},Mine_Explosion:()=>{SoundManager.playRandomSoundFromBank("mine-explosion",{excludeFromLowPassFilter:!0})},Finish_It_Heartbeat_Start:()=>{SoundManager.startLoop("Finish_It_Heartbeat"),SoundManager.startLowPass(e.startFrequency,e.Q,.1,e.endFrequency)},Finish_It_Heartbeat_Stop_Hit:()=>{SoundManager.stopLoop("Finish_It_Heartbeat"),SoundManager.playSound("Finish_It_Hit"),SoundManager.stopLowPass(e.endFrequency,.1)},Finish_It_Heartbeat_Stop_Miss:()=>{SoundManager.stopLoop("Finish_It_Heartbeat"),SoundManager.playSound("Finish_It_Miss"),SoundManager.stopLowPass(e.endFrequency,.1)},Pause_Game:()=>{SoundManager.musicEngine.lockMood("pause",.4)},Resume_Game:()=>{SoundManager.musicEngine.unlockMood(.4)}},s={Powerup_Spin:function(){let e=null,t=null;this.start=function(){Settings.sounds&&(t||(e=SoundManager.playSound("Powerup_Spin_Spin_Start"),t=SoundManager.startLoop("Powerup_Spin_Spin",{start:a.currentTime+e.source.buffer.duration-.1})))},this.stop=function(){Settings.sounds&&e&&t&&(e.source.stop(),t.gain.gain.linearRampToValueAtTime(0,a.currentTime+.2),SoundManager.stopLoop("Powerup_Spin_Spin",{stop:a.currentTime+.2}),t=null)}}};for(let e in t)t[e].limit=t[e].limit||0,t[e].ducking=t[e].ducking||{gain:1,attack:0,sustain:0,release:0};for(let e in n)n[e].limit=n[e].limit||0,n[e].ducking=n[e].ducking||{gain:1,attack:0,sustain:0,release:0};let a,r,l,u={},c=null,d={};let p=-1;function m(e,n){if(!Settings.sounds)return;let i=t[e];if(!i)return void console.warn("No sound with name "+e);if(i.limit>0){if(u[e])return;u[e]=setTimeout(()=>{delete u[e],document.dispatchEvent(new CustomEvent("limitedsoundfinished",{detail:e}))},i.limit),document.dispatchEvent(new CustomEvent("limitedsoundstarted",{detail:e}))}let o=i.buffer;if(n=n||{},!o)return;let s={volume:t[e].volume||1,pan:t[e].pan||0,timeout:t[e].timeout||!1};"volume"in n&&(s.volume=n.volume);for(let e in n)s[e]&&(s[e]=n[e]);let c=a.createBufferSource();c.buffer=o;let d=a.createStereoPanner();d.pan.setTargetAtTime(s.pan,a.currentTime,0);let p=a.createGain();p.gain.setTargetAtTime(s.volume,a.currentTime,0),n.excludeFromLowPassFilter?d.connect(a.destination):d.connect(r),p.connect(d),c.connect(p);let m=n.ducking||i.ducking;return m&&(m.sustain>0||m.attack>0||m.release>0)&&l.duck(m),c.start(n.start||0),document.dispatchEvent(new CustomEvent("soundplayed",{detail:e})),c.onended=(()=>{document.dispatchEvent(new CustomEvent("soundended",{detail:e}))}),{source:c,pan:d,gain:p}}for(let e in i)i[e].active=!1;window.SoundManager={get sounds(){return t},get banks(){return n},get events(){return o},get loops(){return i},get musicEngine(){return l},playSound:m,playRandomSoundFromBank:function(e,t){t=t||{};let i,o=n[e];if(o){if(o.limit>0){if(u["bank_"+e])return;u["bank_"+e]=setTimeout(()=>{delete u["bank_"+e],document.dispatchEvent(new CustomEvent("limitedsoundbankfinished",{detail:e}))},o.limit),document.dispatchEvent(new CustomEvent("limitedsoundbankstarted",{detail:e}))}d[e]=d[e]||[],d[e].length>o.sounds.length/2&&d[e].shift();do{i=o.sounds[Math.floor(Math.random()*o.sounds.length)]}while(d[e].indexOf(i)>-1);d[e].push(i),o.ducking&&(t.ducking=o.ducking),m(i,t),document.dispatchEvent(new CustomEvent("soundbankplayed",{detail:e}))}else console.warn("No soundbank for soundbank name: "+e)},startLoop:function(e,n){if(!Settings.sounds)return;let o=i[e];if(n=n||{},!o)return void console.warn("No loop named",e);if(o.active)return;let s=t[o.sound].volume,r=o.inDuration?0:t[o.sound].volume;n.volume=r;let l=m(o.sound,n);return l.source.loop=!0,o.source=l.source,o.active=!0,o.gain=l.gain,o.inDuration&&o.gain.gain.linearRampToValueAtTime(s,a.currentTime+o.inDuration),document.dispatchEvent(new CustomEvent("loopstarted",{detail:e})),l},stopLoop:function(e,t){if(!Settings.sounds)return;let n=i[e];if(t=t||{},n){if(n.active){let i=n.source;function o(){i.stop(t.stop||a.currentTime),document.dispatchEvent(new CustomEvent("loopstopped",{detail:e}))}n.source=null,n.active=!1,n.outDuration?(n.gain.gain.linearRampToValueAtTime(0,a.currentTime+n.outDuration),setTimeout(o,1e3*n.outDuration)):o()}}else console.warn("No loop named",e)},temporaryLowPass:function(){c&&(clearTimeout(c),document.dispatchEvent(new CustomEvent("lowpassinterrupted",{detail:null}))),r.type="lowpass",r.frequency.cancelScheduledValues(a.currentTime),r.frequency.linearRampToValueAtTime(e.startFrequency,a.currentTime+e.attack),r.frequency.linearRampToValueAtTime(e.startFrequency,a.currentTime+e.attack+e.sustain),r.frequency.linearRampToValueAtTime(e.endFrequency,a.currentTime+e.attack+e.sustain+e.release),c=setTimeout(()=>{c=null,r.type="allpass",document.dispatchEvent(new CustomEvent("lowpassfinished",{detail:null}))},1e3*(e.attack+e.sustain+e.release)),document.dispatchEvent(new CustomEvent("lowpassstarted",{detail:null}))},startLowPass:function(e,t,n,i){n=n||0,e=e||0,i=i||r.frequency,isNaN(n)&&(n=0),isNaN(e)&&(e=0),isNaN(i)&&(i=0),r.type="lowpass",r.frequency.cancelScheduledValues(a.currentTime),r.frequency.setValueAtTime(i,a.currentTime),r.frequency.linearRampToValueAtTime(e,a.currentTime+n)},stopLowPass:function(e,t){t=t||0,e=e||0,isNaN(t)&&(t=0),isNaN(e)&&(e=0),r.frequency.cancelScheduledValues(a.currentTime),r.frequency.linearRampToValueAtTime(e,a.currentTime+t),p>-1&&clearTimeout(p),p=setTimeout(()=>{r.type="allpass"},1e3*t)},findSounds:function(e){let n=[];for(let i in t)i.indexOf(e)>-1&&n.push(i);return n},limitedSoundTimeouts:u,temporaryLowPassSettings:e,localStorageStatus:"Empty",sequences:s,init:function(n){return n=n||{},a=new AudioContext,new Promise((i,o)=>{if(!n.dontWorryAboutWebAudioAutoplayPolicy&&"suspended"===a.state)return void o();l=new Music(a),(r=a.createBiquadFilter()).type="allpass",r.Q.setTargetAtTime(e.Q,a.currentTime,0),r.frequency.setTargetAtTime(e.endFrequency,a.currentTime,0),l.globalGainNode.connect(r),r.connect(a.destination);let s=Object.keys(t),u=s.length+l.getNumberOfAssetsToLoad(),c=0,d=s.map(e=>new Promise((i,o)=>{(function(e){return new Promise((n,i)=>{var o=t[e],s=o.url,r=(o.buffer,new XMLHttpRequest);r.open("GET",s,!0),r.responseType="arraybuffer",r.onload=function(){a.decodeAudioData(r.response,function(e){o.buffer=e,n()})},r.send()})})(e).then(()=>{++c,n.progress&&n.progress(u,c),i()})}));d.push(l.load({progress:(e,t)=>{n.progress&&n.progress(u,c+t)}})),Promise.all(d).then(()=>{n.preventAutoLoadingOfSettings?i():SoundManager.loadSettingsIntelligently().then(()=>{i()})})})},get globalLowPassFilterFrequency(){return r.frequency.value},getSettingsForOutput:function(){let i={sounds:JSON.parse(JSON.stringify(t)),banks:JSON.parse(JSON.stringify(n)),temporaryLowPass:JSON.parse(JSON.stringify(e))};for(let e in i.sounds)delete i.sounds[e].buffer;return i},loadSettingsIntelligently:function(){return new Promise((e,t)=>{window.__soundSettings?(console.log("Found sound precompiled sound settings."),SoundManager.loadSettingsFromJSON(window.__soundSettings),e()):localStorage.getItem("sounds")?(console.log("Found sound settings in Local Storage"),SoundManager.loadSettingsFromLocalStorage(),e()):(console.log("No sound settings in Local Storage. Loading from file."),SoundManager.loadSoundSettingsFile().then(e).catch(t=>{console.error(t),console.log("No sound settings found anywhere. Using defaults."),e()}))})},loadSoundSettingsFile:function(){let e=window.location.href.substr(0,window.location.href.lastIndexOf("/")+1);return new Promise((t,n)=>{fetch(e+"/sound-settings.json",{method:"GET",headers:{"content-type":"application/json"}}).then(e=>{e.ok?e.json().then(e=>{SoundManager.loadSettingsFromJSON(e),t()}):(console.log("naa"),n())}).catch(e=>{console.log("reject"),n(e)})})},loadSettingsFromJSON:function(i){function o(e,t){!function e(t,n){for(let i in n)t[i]&&("object"==typeof n[i]?e(t[i],n[i]):n[i]=t[i])}(t,e)}try{i&&(o(t,i.sound.sounds),o(n,i.sound.banks),o(e,i.sound.temporaryLowPass),l.loadSettingsFromJSON(i.music),SoundManager.localStorageStatus="Loaded")}catch(e){console.warn("Sound/music settings not loaded properly."),console.error(e)}},loadSettingsFromLocalStorage:function(){let e={sound:JSON.parse(localStorage.getItem("sounds")),music:JSON.parse(localStorage.getItem("music"))};e.sound&&e.music&&SoundManager.loadSettingsFromJSON(e)},saveSettingsToLocalStorage:function(){localStorage.setItem("sounds",JSON.stringify(SoundManager.getSettingsForOutput())),localStorage.setItem("music",JSON.stringify(l.getSettingsForOutput())),SoundManager.localStorageStatus="Saved @ "+(new Date).toUTCString()},clearSettingsFromLocalStorage:function(){localStorage.removeItem("sounds"),localStorage.removeItem("music"),SoundManager.localStorageStatus="Empty"},fireEvent:function(e,t){o[e]?o[e](t):console.warn("No sound event named ",e)},resumeAudioContext:function(){return a.resume()}}}(),function(){const e=Settings.powerUpTypes,t=[.35,.75],n=7,i={clone:"Powerup_Bones_Score",grow:"Powerup_Enhance_Score",spin:"Powerup_Spin_Score",noclip:"Powerup_Ghost_Score",magnet:"Powerup_Sticky_Score"},o={default:"Powerup_Spawn",mine:"Bomb_Spawn"},s=Settings.powerupFrequency||30,a=Settings.maxPowerupCount||2;window.PowerupManager=function(r){let l=[];this.automaticSpawning=!0,Object.defineProperty(this,"activePowerups",{get:()=>l}),this.destroy=(()=>{l.forEach(e=>{e.destroy()})}),this.update=(()=>{if(this.automaticSpawning&&getRandom(0,s)<1&&l.length<a){var e=r.boardWidth*r.terrainLinePercent/100;e<50?e=50:e>r.boardWidth-50&&(e=r.boardWidth-50);var t=getRandom(50,r.boardHeight-50);let n=this.addPowerup(e,t);n&&l.push(n)}}),this.addPowerup=((t,n)=>{if(0===e.length)return;let i=e[Math.floor(Math.random()*e.length)],s=this.createPowerup(t,n,i);return s.element.classList.add(i),SoundManager.playSound(o[i]||o.default),s}),this.createPowerup=((e,o,s)=>{var a={width:30,height:30,x:e-15,y:o},u={frictionAir:.0075/r.physicsSamplingRatio,restitution:1,label:"powerup-"+s};return"mine"==s&&(a.width=56,a.height=56,a.lifeSpan=getRandom(150,350),a.ignoreRotation=!0,a.x=e-a.width/2,u.frictionAir=.05/r.physicsSamplingRatio,u.mass=1.5,a.innerHTML="\n        <div class='mine-line'></div>\n        <div class='shadow'></div>\n        <div class='body'>\n          <div class='light'></div>\n        </div>"),"noclip"==s&&(a.width=28,a.height=28),"magnet"==s&&(a.ignoreRotation=!0),createObject({className:"powerup",innerHTML:a.innerHTML||"<div class='shadow'></div><div class='body'></div>",gotHit:!1,gotHitFlag:!1,hitBy:"",type:s,lifeSpan:a.lifeSpan||"infinite",ignoreRotation:a.ignoreRotation||!1,beepTimeoutMS:325,beepTimeout:!1,properties:a,physicsOptions:u,launch:function(e,t){Matter.Body.applyForce(this.physics,this.physics.position,{x:e,y:t})},run:function(){if("infinite"!=this.lifeSpan){this.lifeSpan--,"mine"!==this.type||this.lineEl||(this.lineEl=this.element.querySelector(".mine-line"));let t=this.physics.position.y-this.height/2;if(this.lineEl.style.transform="translateY(-"+t+"px)",this.lifeSpan<125){if(this.element.classList.add("lineBlink"),!this.beepTimeout){SoundManager.playSound("beep");var e=this;this.beepTimeout=setTimeout(function(){e.beepTimeout=!1},this.beepTimeoutMS)}this.element.querySelector(".light").classList.add("fastBlink")}this.lifeSpan<0&&this.explode()}},explode:function(){r.boardWidth,r.terrainLinePercent;var e,t=this.physics.position.x,n=r.terrainLinePercent/100-this.physics.position.x/r.boardWidth;e=n<0?1:2;var i=document.createElement("div");i.classList.add("mine-line"),document.querySelector(".blast-zone").append(i),i.style.left=t+"px",setTimeout(function(){r.moveTerrain(e,Math.abs(100*n))},400),setTimeout(function(){i.remove()},450),r.objectsToRender.forEach(e=>{if(e!==this){var t=e.physics.position.x-this.physics.position.x,n=e.physics.position.y-this.physics.position.y,i=window.Settings.mineForceRadius||175;t*t+n*n>i*i||(t*=(window.Settings.mineForceMultiplier||5e-4)*e.physics.mass,n*=(window.Settings.mineForceMultiplier||5e-4)*e.physics.mass,Matter.Body.applyForce(e.physics,e.physics.position,{x:t,y:n}))}}),mineExplosion(this.physics.position.x,this.physics.position.y,100);var o={y:this.physics.position.y-40,x:this.physics.position.x-30,width:60,height:60,zV:3,yV:-3,xV:0,gravity:.2,yRv:getRandom(-1,1),xRv:getRandom(10,16),oV:-.05,lifespan:230,o:2,className:"mine-chunk"};makeParticle(o),this.physics.position.x,this.physics.position.y,makeParticle({x:this.physics.position.x-8,y:this.physics.position.y-8,width:16,height:16,zV:5,gravity:.2,yV:-3,xV:getRandom(-2,2),xRv:getRandom(10,14),lifespan:40,o:1,className:"mine-chunk-light"}),makeCracks(this.physics.position.x,this.physics.position.y),this.destroy()},hit:function(e){var o=!1,s=!1;if("wall-right"==e.label)s=0,o=!0;else if("wall-left"==e.label)s=1,o=!0;else if(e.label.indexOf("wall-")>-1)SoundManager.playSound("Powerup_Bounce_Wall");else if(e.label.indexOf("paddle")>-1||e.label.indexOf("ball")>-1)if("mine"==this.type){let i=Math.min(n,Math.abs(this.physics.speed-e.speed))/n,o=(t[1]-t[0])*i+t[0];SoundManager.playRandomSoundFromBank("mine-collision",{volume:o})}else e.label.indexOf("paddle")>-1?SoundManager.playSound("Powerup_Bounce_Paddle"):e.label.indexOf("ball")>-1&&SoundManager.playSound("Powerup_Bounce_Paddle");if(o&&"mine"!=this.type){if("magnet"==this.type||"clone"==this.type||"grow"==this.type||"spin"==this.type||"noclip"==this.type)for(var a=0;a<2;a++)r.paddles[a].player==s&&(r.paddles[a].powerup(this.type),r.paddles[a].hasSpinPowerup||r.gotPowerup(s,this.type));powerupScored(this.physics.position.x,this.physics.position.y,this.type),this.destroy(),SoundManager.playSound(i[this.type]||"coin")}},destroy:function(){this.destroyed=!0,r.removeObject(this),l.splice(l.indexOf(this),1)}})})}}(),function(){const e={intense:3500},t=["music/GamplayMusic1_Intro_Layer1.mp3","music/GamplayMusic1_Intro_Layer2.mp3","music/GamplayMusic1_Intro_Layer3.mp3","music/GamplayMusic1_PartA&B_Layer1.mp3","music/GamplayMusic1_PartA&B_Layer2.mp3","music/GamplayMusic1_PartA&B_Layer3.mp3","music/GamplayMusic1_PartA&B_Layer4.mp3","music/MenuMusic1.mp3"],n={menu:{loopDuration:69.81818181,layers:{one:{file:"music/MenuMusic1.mp3",moods:{default:1}}}},gameplayIntro:{bps:1/(110/60),loopDuration:34.909090909,layers:{one:{file:"music/GamplayMusic1_Intro_Layer1.mp3",moods:{default:1,pause:1}},two:{file:"music/GamplayMusic1_Intro_Layer2.mp3",moods:{default:1,pause:0}},three:{file:"music/GamplayMusic1_Intro_Layer3.mp3",moods:{default:1,pause:0}}}},gameplay:{bps:1/(110/60),loopDuration:69.81818181,layers:{one:{file:"music/GamplayMusic1_PartA&B_Layer1.mp3",moods:{default:1,pause:1,level1:1,level2:1,level3:1,level4:1}},two:{file:"music/GamplayMusic1_PartA&B_Layer2.mp3",moods:{default:1,pause:0,level1:1,level2:1,level3:1,level4:1}},three:{file:"music/GamplayMusic1_PartA&B_Layer3.mp3",moods:{default:0,pause:0,level1:0,level2:0,level3:1,level4:1}},four:{file:"music/GamplayMusic1_PartA&B_Layer4.mp3",moods:{default:0,pause:0,level1:0,level2:0,level3:0,level4:1}}}}};let i={gameplay:[{name:"gameplayIntro"},{name:"gameplay",loop:!0}]},o={default:-1,level1:0,level2:5,level3:10,level4:20};window.Music=function(e){const o={},a=[],r=[];let l=null,u=e.createGain(),c=e.createGain(),d={};function p(){r.forEach(e=>e())}u.gain.setValueAtTime(.3,e.currentTime),c.connect(u),u.connect(e.destination),this.duckingNode=c,this.globalGainNode=u,this.getMoods=function(){if(l)return l.getMoods()},this.temporarilyReduceGain=function(e){if(l)return l.temporarilyReduceGain(e)},this.resetGlobalGain=function(){if(l)return l.resetGlobalGain()},this.setGlobalGain=function(e,t){if(l)return l.setGlobalGain(e,t)},this.getGlobalGain=(()=>{if(l)return l.getGlobalGain()}),this.duck=function(e){if(l)return l.duck(e)},this.lockMood=function(e,t){if(l)return l.lockMood(e,t)},this.unlockMood=function(e,t){if(l)return l.unlockMood(e,t)},this.setMood=function(e,t){if(l)return l.setMood(e,t)},this.setLayerMood=function(e,t){if(l)return l.setLayerMood(e,t)},this.setLevels=function(e){if(l)return l.setLevels(e)},this.getLayerDefinitions=(()=>{if(l)return l.getLayerDefinitions()}),this.getLayers=(()=>{if(l)return l.getLayers()}),this.getContext=(()=>{if(l)return l.getContext()}),this.addIntensity=(e=>{if(l)return l.addIntensity(e)}),this.reset=function(){c.gain.cancelScheduledValues(e.currentTime),u.gain.cancelScheduledValues(e.currentTime),u.gain.setValueAtTime(.3,e.currentTime),c.gain.setValueAtTime(1,e.currentTime)},Object.defineProperties(this,{currentIntensity:{get:()=>{if(l)return l.currentIntensity}},targetIntensity:{get:()=>{if(l)return l.targetIntensity},set:e=>{l&&(l.targetIntensity=e)}},bps:{get:()=>l?l.songDefinition.bps:0}}),this.status="loading",this.currentSongName=null,this.cueSong=function(e){l=o[e],o[e]||console.warn("No song named ",e),this.currentSong=l,this.currentSongName=e,this.status="ready"},this.getNumberOfAssetsToLoad=function(){return t.length},this.prepareSong=function(t){return o[t]=new s(t,e,d,n[t],u,c),o[t].load()},this.prepareSongs=function(e){return new Promise((t,n)=>{let i=[];e.forEach(e=>{i.push(this.prepareSong(e))}),Promise.all(i).then(()=>{this.status="ready",t()})})},this.load=function(i){return i=i||{},new Promise(async(o,s)=>{let a=0;Promise.all(t.map(n=>new Promise((o,s)=>{let r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType="arraybuffer",r.onload=(()=>e.decodeAudioData(r.response,e=>{d[n]=e,++a,i.progress&&i.progress(t.length,a),o(e)})),r.send()}))).then(()=>{this.prepareSongs(Object.keys(n)).then(o)})})},this.addSongChainListener=function(e){a.push(e)},this.playSongChain=function(e){this.reset();let t=i[e].slice();for(let e in t)this.prepareSongs(t.map(e=>e.name));l&&l.stop();let n=()=>{let e=l,i=t.shift(),o=0,s="default";e&&(l.clearLoopListeners(),o=l.getIntensity(),s=l.getMood()),this.cueSong(i.name),i.loop||l.addLoopListener(n),e&&e.isMoodLocked()?l.lockMood(s,0):l.setMood(s,0),l.setIntensity(o,!0),this.start({loop:i.loop}),a.forEach(e=>e())};n()},this.addBeatCallback=function(e){r.push(e)},this.removeBeatCallbacks=function(){for(;r.length>0;)r.shift()},this.start=function(e){return this.status="playing",l.setBeatCallback(p),l.start(e)},this.stop=function(){return this.status="stopped",l.resetSongGainNode(),l.setBeatCallback(null),l.stop()},this.fadeIn=function(e,t){return this.status="playing",l.fadeIn(e,t)},this.fadeOut=function(e){return l?l.fadeOut(e).then(()=>{this.status="stopped",l.setBeatCallback(null)}):null},this.getSettingsForOutput=function(){return{globalGainValue:u.gain.value}},this.loadSettingsFromJSON=function(t){t&&u.gain.setValueAtTime(t.globalGainValue,e.currentTime)},this.getSongs=(()=>n),this.getSongChains=(()=>i)};let s=function(t,n,i,s,a,r){let l,u={},c=0,d=0,p=0,m=0,h=s.layers,g=[],y=!1,_=null,f=null,w=-1,S="default",v=null,P=-1,b=!1,M=0,k=null,L=null,V=.3,B=(n=n||new AudioContext).createGain();this.temporaryMoodDurations=e,this.currentDuckingProfile=null,this.duckingNode=r,this.globalGainNode=a,this.currentIntensity=d;let x=d,T=x;function E(e,t){let i=n.createGain(),o=h[e].moods.default;o=isNaN(Number(o))?0:o,i.gain.value=o,i.connect(B);let a={source:null,lastSource:null,createSourceNode:()=>{let e=n.createBufferSource();return e.buffer=t,e.connect(i),e.loop=!1,e},start:()=>{a.source=a.createSourceNode(),a.source.start(0)},stop:()=>{a.source&&(a.source.stop(),a.source.disconnect(i),a.source=null)},getLoopSwappingReady:function(){let e=a.createSourceNode(),t=a.source;e.start(c+s.loopDuration),a.source=e,a.lastSource&&a.lastSource.disconnect(i),a.lastSource=t},source:null,gain:i,temporaryLevelDelay:null};return a}function C(){let e="default",t=-1;for(let n in o)o[n]<=d&&o[n]>t&&(e=n,t=o[n]);return e}Object.defineProperty(this,"targetIntensity",{get:()=>x,set:e=>{T=e}}),this.songDefinition=s,B.connect(r),B.gain.value=1,this.resetSongGainNode=(()=>{B.gain.setValueAtTime(1,n.currentTime)}),this.getMoods=function(){let e=[];for(let t in h)if(h[t].moods)for(let n in h[t].moods)-1===e.indexOf(n)&&e.push(n);return e},this.temporarilyReduceGain=function(e){V=this.getGlobalGain(),this.setGlobalGain(V*e,.15)},this.resetGlobalGain=function(){this.setGlobalGain(V,.75)},this.setGlobalGain=function(e,t){t=t||0,a.gain.setTargetAtTime(e,n.currentTime,t)},this.getGlobalGain=(()=>a.gain.value),this.duck=function(e){e&&(w>-1&&(clearTimeout(w),document.dispatchEvent(new CustomEvent("duckinginterrupted"))),document.dispatchEvent(new CustomEvent("duckingstarted",{detail:e})),r.gain.cancelScheduledValues(n.currentTime),r.gain.linearRampToValueAtTime(e.gain,n.currentTime+e.attack),r.gain.linearRampToValueAtTime(e.gain,n.currentTime+e.attack+e.sustain),r.gain.linearRampToValueAtTime(1,n.currentTime+e.attack+e.sustain+e.release),w=setTimeout(()=>{w=-1,document.dispatchEvent(new CustomEvent("duckingstopped"))},1e3*(e.attack+e.sustain+e.release)))},this.load=function(){return new Promise(async(e,t)=>{for(let e in h)i[h[e].file]||console.warn("Buffer for",e,"does not exist."),u[e]=E(e,i[h[e].file]);e()})},this.lockMood=function(e,t){L=S,k=e,this.setMood(e,t),this.stopMoodInterval()},this.unlockMood=function(e){k&&(this.setMood(L,e),this.startMoodInterval(),k=null,L=null)},this.isMoodLocked=function(){return!!k},this.setMood=function(e,t){S=e;for(let n in u)this.setLayerMood(n,e,t)},this.setLayerMood=function(e,t,i){let o=u[e];if(!o)return void console.warn("No music layer named ",e);i=i||0;let s=h[e].moods.default;t in h[e].moods&&(s=h[e].moods[t]),isNaN(Number(s))||u[e].gain&&(o.gain.gain.cancelScheduledValues(n.currentTime),0===i?o.gain.gain.value=s:o.gain.gain.linearRampToValueAtTime(s,n.currentTime+i),document.dispatchEvent(new CustomEvent("musicmoodstart",{detail:t})))},this.setLevels=function(e){for(let t in e){if(!u[t].gain)return;u[t].gain.gain.setTargetAtTime(e[t],n.currentTime,0)}},this.addLoopListener=function(e){g.push(e)},this.clearLoopListeners=function(){g=[]},this.reportLayers=function(){for(let e in u)console.log("SONG",t,"layer",e," gain value ",u[e].gain.gain.value)},this.start=function(e){let t=0,i=Object.keys(u).length;y=(e=e||{}).loop;for(let e in u)u[e].start(),y||u[e].source.addEventListener("ended",e=>{++t===i&&this.stop()});M=n.currentTime,b=!1,this.startBeatInterval(),this.startLoopingInterval(),k||this.startMoodInterval()},this.setBeatCallback=function(e){v=e},this.startBeatInterval=function(){P=setInterval(()=>{let e=n.currentTime-M;1===Math.round(e%s.bps)?b=!0:!0===b&&(b=!1,v&&v())},10)},this.stopBeatInterval=function(){P>-1&&clearInterval(P),P=-1},this.startLoopingInterval=function(){c=n.currentTime,_=setInterval(()=>{if(n.currentTime-c>s.loopDuration-1){if(y)for(let e in u){u[e].getLoopSwappingReady()}let e=c+s.loopDuration-n.currentTime;c+=s.loopDuration,setTimeout(function(){g.forEach(e=>e())},1e3*e)}},50)},this.stopLoopingInterval=function(){_>0&&(clearInterval(_),_=-1)},this.startMoodInterval=function(){l=Date.now(),f=setInterval(()=>{let e;Date.now()-l>1e3&&(l=Date.now(),x=T),d=(m-=.75*(m-x))+(p-=.01*p),this.currentIntensity=d;let t=-1;for(let n in o)o[n]<=d&&o[n]>t&&(e=n,t=o[n]);let n=C();S!==n&&this.setMood(n,.95)},50)},this.getIntensities=function(){console.log("intensityChangeDelay: ",1e3),console.log("lastIntensityChangeTime: ",l),console.log("time delta: ",Date.now()-l),console.log("Base: ",m),console.log("Boost: ",p),console.log("Target: ",this.targetIntensity),console.log("Total: ",this.currentIntensity)},this.stopMoodInterval=function(){f>0&&(clearInterval(f),f=-1)},this.stop=function(){for(let e in u)u[e].stop();this.stopMoodInterval(),this.stopLoopingInterval(),this.stopBeatInterval(),B.gain.cancelScheduledValues(n.currentTime)},this.fadeIn=function(e,t){B.gain.setValueAtTime(0,n.currentTime),B.gain.linearRampToValueAtTime(1,n.currentTime+e),this.start(t)},this.fadeOut=function(e){return B.gain.linearRampToValueAtTime(0,n.currentTime+e),new Promise((t,n)=>{setTimeout(()=>{this.stop(),t()},1e3*e)})},this.getLayerDefinitions=(()=>h),this.getLayers=(()=>u),this.getContext=(()=>n),this.getMood=(()=>S),this.getIntensity=(()=>d),this.addIntensity=(e=>{p+=Number(e);let t=C();S!==t&&this.setMood(t,.95)}),this.setIntensity=((e,t)=>{if(e=Number(e),this.targetIntensity=e,t&&(m=e),k)return;let n=C();S!==n&&this.setMood(n,.95)})}}();var axisThreshold=.1;function createInputComponent(e,t){if(!e)throw"inputToActionMapping is required to create an input component";var n={inputToActionMapping:e,actions:{},update:function(e){},register:function(e){this.actions=e,t.register&&t.register.call(this,e)},remove:function(){t.remove&&t.remove.call(this)}};for(var i in t)"register"!==i&&"remove"!==i&&(n[i]=t[i]);return n}function createGamepadInputComponent(e){return console.log("%cInitializing Gamepad Input Component","color: blue"),console.log("  ID: "+e.id),console.log("  Interpretted Type: %c"+e.type,"background: #222; color: #bada55"),createInputComponent(e.inputToActionMapping,{type:"gamepad",config:e,gamepad:e.gamepad,lastTimestamp:e.gamepad.timestamp,register:function(){this.config.use()},update:function(){if(!this.gamepad)return{};var e={};if(GamepadManager.refreshGamepads(),this.gamepad.timestamp>this.lastTimestamp){for(var t=0;t<this.gamepad.buttons.length;++t){var n=this.gamepad.buttons[t].pressed?1:0;e[i=this.inputToActionMapping.buttons[t]]=n}for(t=0;t<this.gamepad.axes.length;++t){var i,o=this.gamepad.axes[t];(i=this.inputToActionMapping.axes[t])&&(Math.abs(o)>axisThreshold?e[i]=o:e[i]=0)}}return e},remove:function(){console.log("%cDestroying Gamepad Input Component","color: red"),this.config.release()}})}function createKeyboardInputComponent(e){console.log("%cInitializing Keyboard Input Component","color: blue");var t=createInputComponent(e.inputToActionMapping,{type:"keyboard",config:e,register:function(){document.addEventListener("keydown",i),document.addEventListener("keyup",o)},update:function(e){return n},remove:function(){console.log("%cDestroying Keyboard Input Component","color: red"),document.removeEventListener("keydown",i),document.removeEventListener("keyup",o),this.config.release()}}),n={};function i(e){e.code in t.inputToActionMapping&&(n[t.inputToActionMapping[e.code]]=!0)}function o(e){e.code in t.inputToActionMapping&&(n[t.inputToActionMapping[e.code]]=!1)}return t}let buttons,selectedButton,selectedIndex;window.InputManager=function(e,t){console.log('Creating Input Manager "'+t+'"');let n=[],i=localStorage.getItem("inputLabelToActionMappings");i&&(i=JSON.parse(i),keyboardInputLabelToActionMappings=i.keyboard,gamepadInputLabelToActionMapping=i.gamepad),this.refreshGamepadComponentsInMaintainedObjects=function(e){n.forEach(t=>{e!==t&&"gamepad"===t.inputComponent.type&&(t.setInputComponent(null),t.setInputComponent(this.getComponentForNextAvailableInput()))})},this.setupInputForObject=function(t){t.setInputComponent(this.getComponentForNextAvailableInput()),n.push(t),e(t)},this.resetManagedObjects=function(){n.forEach(e=>{e.setInputComponent(null)})},this.forgetManagedObjects=function(){n=[]},this.createInputComponentFromConfigIndex=function(e,t){return("gamepad"===e?createGamepadInputComponent:createKeyboardInputComponent)(("gamepad"===e?GamepadManager:KeyboardManager).getConfigByIndex(t))},this.getComponentForNextAvailableInput=function(){var e=GamepadManager.getUnusedGamepad();return e?createGamepadInputComponent(e):createKeyboardInputComponent(KeyboardManager.getUnusedConfig())};const o=e=>{console.log("Gamepad Connected: ",e),a()},s=t=>{console.log("Gamepad Disconnected");for(let i in n){let o=n[i];if("gamepad"===o.inputComponent.type){let n=t.gamepad.id+t.gamepad.index;if(o.inputComponent.config.id===n)return o.setInputComponent(this.getComponentForNextAvailableInput()),e(o),void this.refreshGamepadComponentsInMaintainedObjects(o)}}};function a(){if(0===n.length)return;let t=GamepadManager.getUnusedGamepad();if(t)for(let i=0;i<n.length;++i){let o=n[i];if("keyboard"===o.inputComponent.type)return o.setInputComponent(createGamepadInputComponent(t)),void e(o)}}let r=setInterval(function(){a()},500);window.addEventListener("gamepadconnected",o),window.addEventListener("gamepaddisconnected",s),this.destroy=function(){console.log('Destroying Input Manager "'+t+'"'),clearInterval(r),window.removeEventListener("gamepadconnected",o),window.removeEventListener("gamepaddisconnected",s),this.resetManagedObjects(),this.forgetManagedObjects()}},window.KeyboardManager=function(){var e=keyboardInputLabelToActionMappings,t=[];function n(e){this.inputToActionMapping=keyboardInputLabelToActionMappings[e],this.id=e,this.release=function(){var e,n;e=this,(n=t.indexOf(e))>-1&&t.splice(n,1)},t.push(this)}function i(e){for(var n=0;n<t.length;++n)if(t[n].id===e)return!0;return!1}return{report:function(){console.log("Keyboard Manager Report: "+t.length+" in use.")},getAllConfigs:function(){return e},getConfigByIndex:function(e){return new n(e)},getUnusedConfig:function(){for(var t=0;t<e.length;++t)if(!i(t))return new n(t);return null}}}(),InputManager.GamepadEventManager=function(){let e={up:{},down:{}},t=[],n={},i=[],o=!1;function s(){GamepadManager.refreshGamepads();let a={};t.forEach(e=>{e.gamepad.timestamp<e.initTimestamp+1e3||i.forEach(t=>{e.gamepad.buttons[e.inverseInputLabelMapping.buttons[t]]&&e.gamepad.buttons[e.inverseInputLabelMapping.buttons[t]].pressed&&(a[t]=!0)})}),i.forEach(t=>{if(!n[t]&&a[t])n[t]=Date.now()+250,setTimeout(()=>r(t),10);else if(n[t]&&a[t]){let e=Date.now();e>n[t]&&(n[t]=e+50,setTimeout(()=>r(t),10))}else n[t]&&!a[t]&&(delete n[t],setTimeout(()=>(function(t){e.up[t]&&e.up[t].forEach(e=>e())})(t),10))}),o||requestAnimationFrame(s)}function a(){let t=Object.keys(e.up),n=Object.keys(e.down);i=n.concat(t.filter(e=>-1===n.indexOf(e)))}function r(t){e.down[t]&&e.down[t].forEach(e=>e())}this.onGamepadButtonDown=function(t,n){Array.isArray(t)?t.forEach(e=>this.onGamepadButtonDown(e,n)):(e.down[t]=e.down[t]||[],e.down[t].push(n),a())},this.onGamepadButtonUp=function(t,n){Array.isArray(t)?t.forEach(e=>this.onGamepadButtonDown(e,n)):(e.up[t]=e.up[t]||[],e.up[t].push(n),a())},this.addButtonListener=function(e,t,n){if("up"===t)this.onGamepadButtonUp(e,n);else{if("down"!==t)throw new Error("You can't do that.");this.onGamepadButtonDown(e,n)}},this.removeButtonListener=function(t,n,i){Array.isArray(t)?t.forEach(e=>this.removeButtonListener(e,n,i)):e[n][t]&&(e[n][t]=e[n][t].filter(e=>e!==i),a())},this.start=function(){s(),this.connectAllGamepads(),window.addEventListener("gamepadconnected",e=>{this.connectAllGamepads()}),window.addEventListener("gamepaddisconnected",e=>{this.connectAllGamepads()})},this.pause=function(){o=!0},this.resume=function(){o=!1,s()},this.connectAllGamepads=function(){GamepadManager.getGamepads();t=GamepadManager.getConfigs()}},window.GamepadManager=function(){let e,t=[];function n(e,n){let i="standard";e.mapping?i=e.mapping:e.id.toLowerCase().indexOf("xbox")>-1&&(i="xbox");let o=gamepadInputLabels[i],s=Object.keys(gamepadInputLabelToActionMapping),a={buttons:{},axes:{}};Object.keys(o.buttons).forEach(function(e){let t=o.buttons[e];if(s.indexOf(t)>-1){let n=gamepadInputLabelToActionMapping[t];a.buttons[e]=n}}),Object.keys(o.axes).forEach(function(e){let t=o.axes[e];if(s.indexOf(t)>-1){let n=gamepadInputLabelToActionMapping[t];a.axes[e]=n}});let r=e.id+e.index;this.inputLabelMapping=o,this.inverseInputLabelMapping=inverseGamepadInputLabels[i],this.inputToActionMapping=a,this.id=r,this.type=i,this.gamepad=e,this.initTimestamp=e.timestamp,this.lastTimestamp=e.timestamp,this.use=function(){t.push(this)},this.release=function(){!function(e){let n=t.indexOf(e);n>-1&&t.splice(n,1)}(this)}}function i(e){let n=e.id+e.index;for(let e=0;e<t.length;++e)if(t[e].id===n)return!0;return!1}function o(){e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[]}function s(){let t=[];o();for(let n=0;n<e.length;++n)e[n]&&t.push(e[n]);return t}return{report:function(){console.log("Gamepad Manager Report: "+t.length+" in use.")},refreshGamepads:o,getGamepads:s,getConfigs:function(e){return s().map(e=>new n(e))},getConfigsInUse:function(){return t},getConfigByIndex:function(t){return new n(e[t])},getUnusedGamepad:function(){o();for(let t=0;t<e.length;++t)if(e[t]&&!i(e[t]))return new n(e[t]);return null}}}();const keyDownListener=e=>{let t={ArrowRight:"right",ArrowLeft:"left",ArrowUp:"up",ArrowDown:"down",Enter:"go"};t[e.key]&&moveCursor(t[e.key])},setupInputButtons=e=>{(buttons=Array.prototype.slice.call(document.querySelectorAll(".gamepad-button"))).forEach(e=>{e.onmouseover=(e=>{buttons.forEach(e=>{e.classList.remove("input-selected")})})});let t=new InputManager.GamepadEventManager,n=()=>{moveCursor("left")},i=()=>{moveCursor("right")},o=()=>{moveCursor("down")},s=()=>{moveCursor("up")},a=()=>{e||moveCursor("go")},r=()=>{moveCursor("go")};return t.addButtonListener("dPadLeft","down",n),t.addButtonListener("dPadRight","down",i),t.addButtonListener("dPadDown","down",o),t.addButtonListener("dPadUp","down",s),t.addButtonListener(["start","home"],"down",a),t.addButtonListener(["actionUp","actionDown","actionLeft","actionRight"],"down",r),t.start(),t.pause(),{clearSelectedButton:()=>{selectedButton=null},disconnect:()=>{window.removeEventListener("keydown",keyDownListener),t.pause()},connect:()=>{window.addEventListener("keydown",keyDownListener),t.resume()}}};function moveCursor(e){selectedButton&&(selectButtonByDirection(selectedButton,e),SoundManager.playSound("Menu_Move"),"go"===e&&selectedButton&&selectedButton&&selectedButton.click())}const getCenter=e=>{let t=e.getBoundingClientRect();return{x:Math.floor(t.left+t.width/2),y:Math.floor(t.top+t.height/2)}},selectButtonByDirection=(e,t)=>{let n,i,o=getCenter(e),s=parseInt(e.getAttribute("col")),a=parseInt(e.getAttribute("row")),r=[];document.querySelectorAll("[row][col]").forEach(e=>{e.offsetParent&&r.push(e)});let l=[];r.forEach(e=>{let t=parseInt(e.getAttribute("row"));l.indexOf(t)<0&&l.push(t)});Math.max(...l);let u=[];if(r.forEach(e=>{parseInt(e.getAttribute("row"))===a&&u.push(e)}),"right"!=t&&"left"!=t||("right"===t&&(s<u.length?(n=a,i=s+1):(n=a,i=1)),"left"===t&&(s>1?(n=a,i=s-1):(n=a,i=u.length)),r.forEach(e=>{parseInt(e.getAttribute("row"))===n&&parseInt(e.getAttribute("col"))===i&&selectButtonEl(e)})),"up"===t||"down"===t){let e=l.indexOf(a);"down"===t&&(a=l.indexOf(a)+1<l.length?l[e+1]:l[0]),"up"===t&&(a=0===l.indexOf(a)?l[l.length-1]:l[e-1]);let n=[];r.forEach(e=>{parseInt(e.getAttribute("row"))===a&&n.push(e)});let i=!1,s=9999999;n.forEach(e=>{let t=Math.abs(o.x-getCenter(e).x);t<s&&(i=e,s=t)}),selectButtonEl(i)}},selectButtonEl=e=>{deselectAllButtons(),selectedButton=e,e.classList.add("input-selected")},selectButtonByRowCol=(e,t)=>{deselectAllButtons(),(selectedButton=document.querySelector(`[row='${e}'][col='${t}']`)).classList.add("input-selected")},selectButtonBySelector=e=>{deselectAllButtons(),(selectedButton=document.querySelector(e)).classList.add("input-selected")},selectButtonByIndex=e=>{deselectAllButtons(),selectedIndex=e||0,selectedButton=buttons[e];let t=0;buttons.map(n=>{n.offsetHeight>0&&(t===e&&(selectedButton=n),t++)}),selectedButton.classList.add("input-selected")},deselectAllButtons=()=>{buttons.forEach(e=>{e.classList.remove("input-selected")}),selectedButton=!1};function PauseManager(e,t,n){let i=new InputManager.GamepadEventManager;i.addButtonListener(["start","home"],"down",l),i.start();let o=[];function s(e,t,n){for(let i=0;i<o.length;++i)if(o[i].el===e&&o[i].type===t&&o[i].function===n)return;o.push({el:e,type:t,function:n}),e.addEventListener(t,n)}let a=["Watch out for","You can rely on","Space is no limit for","There's always time for","Make way for","Real soldiers are forged by","Hopes and dreams rely on"],r=!1;function l(){r?m():h()}const u=e=>{"Escape"===e.key&&l()};s(window,"keydown",u);let c=document.querySelector(".menu-toggle");const d=()=>{r?m():h(),SoundManager.playSound("Menu_Select")};s(document.querySelector(".button.restart"),"click",t=>{n.clearSelectedButton(),e.rematch(),addTemporaryClassName(t.target,"poke",250),buttonGleam(t.target),SoundManager.playSound("Menu_Select")});s(document.querySelector(".button.settings"),"click",()=>{g("splash"),SoundManager.playSound("Menu_Select")});const p=e=>{addTemporaryClassName(e.target,"poke",250),SoundManager.playSound("Menu_Select"),buttonGleam(e.target),g(e.target.getAttribute("nav"))};document.querySelectorAll("[nav]").forEach(function(e){s(e,"click",p)});function m(){n.disconnect(),document.querySelector(".pause-screen").classList.remove("visible"),r=!1,e.resume(),deselectAllButtons(),SoundManager.fireEvent("Resume_Game")}function h(){"running"==e.mode&&(document.querySelector("#pause-pre-title").textContent=a[Math.floor(a.length*Math.random())]+"...",document.querySelector(".pause-screen").classList.add("visible"),e.pause(),r=!0,selectButtonByIndex(2),SoundManager.fireEvent("Pause_Game"),n.connect())}function g(e){ScreenManager.transitionToScreen(e)}s(document.querySelector(".resume"),"click",e=>{SoundManager.playSound("Menu_Select"),addTemporaryClassName(e.target,"poke",250),buttonGleam(e.target),m()}),this.enableMenuButton=function(){s(c,"click",d),c.classList.remove("off")},this.disableMenuButton=function(){var e,t,n;e=c,t="click",n=d,o=o.filter(i=>i.el!==e||i.type!==t||i.function!==n||(e.removeEventListener(t,n),!1)),c.classList.add("off")},this.destroy=function(){for(;o.length>0;){let e=o.shift();e.el.removeEventListener(e.type,e.function)}document.querySelector(".pause-screen").classList.remove("visible"),r=!1,deselectAllButtons(),n.disconnect(),i.pause(),window.removeEventListener("keydown",u)}}function getElementProperties(e){var t=e.offsetWidth,n=e.offsetHeight,i=e.offsetLeft+t/2,o=e.offsetTop+n/2,s=window.getComputedStyle(e,null),a=s.getPropertyValue("transform");"none"==a&&(a="matrix(1, 0, 0, 1, 0, 0)");var r=a.split("(")[1].split(")")[0].split(","),l=r[0],u=r[1],c=r[2],d=r[3],p=r[4],m=r[5];i+=parseInt(p),o+=parseInt(m);Math.sqrt(l*l+u*u);var h=Math.sqrt(l*l+c*c);n*=Math.sqrt(u*u+d*d).toFixed(2),t*=h.toFixed(2);var g=Math.atan2(u,l),y="rectangle",_=parseInt(s.borderTopLeftRadius),f=n/t;return f>.9&&f<1.1&&_>t/2*.4&&(y="circle"),{height:n,width:t,x:i,y:o,angle:g,bodyType:y}}function createPhysicsForElement(e,t){var n=getRandom(0,9999999),i=getElementProperties(e),o={isStatic:!!e.hasAttribute("data-static")&&e.getAttribute("data-static"),angle:i.angle};Object.assign(o,t);var s=!1;if("rectangle"==i.bodyType&&(s=Matter.Bodies.rectangle(i.x,i.y,i.width,i.height,o)),"circle"==i.bodyType&&(s=Matter.Bodies.circle(i.x,i.y,i.width/2,o)),s.guid=n,resetElementPosition(e),s)return s}function createObject(e){var t={selector:!1,element:!1,physics:!1,width:0,height:0,x:0,y:0,physicsOptions:{frictionAir:.1,restitution:1},inputComponent:null,actions:[],setPhysicsProperties:function(e){Matter.Body.setAngularVelocity(this.physics,e.angularVelocity),Matter.Body.setAngle(this.physics,e.angle),Matter.Body.setPosition(this.physics,e.position),Matter.Body.setVelocity(this.physics,e.velocity)},getPhysicsProperties:function(){return{position:this.physics.position,angle:this.physics.angle,velocity:this.physics.velocity,angularVelocity:this.physics.angularVelocity}},setInputComponent:function(e){this.inputComponent&&this.inputComponent.remove(),e?(this.inputComponent=e,e.register(this.actions)):this.inputComponent=null,document.dispatchEvent(new CustomEvent("inputcomponentchanged",{detail:{object:this,inputComponent:e}}))},updateActionsFromInputComponents:function(){if(this.inputComponent){let e=this.inputComponent.update();for(let t in this.actions)this.actions[t]=0,t in e&&(this.actions[t]=e[t])}},init:function(){for(var t in e)this[t]=e[t];var n;if(e.physicsOptions&&Object.assign(this.physicsOptions,e.physicsOptions),this.selector&&(this.element=document.querySelector(this.selector)),this.element)n=getElementProperties(this.element);else{if(n=e.properties||{},this.element=document.createElement("div"),n.classNames)for(var i=0;i<n.classNames.length;i++){var o=n.classNames[i];this.element.classList.add(o)}this.element.classList.add(e.className),this.element.innerHTML=e.innerHTML||"",e.noBody||document.querySelector(".world").appendChild(this.element),this.element.style.height=n.height+"px",this.element.style.width=n.width+"px",this.x=n.x,this.y=n.y,this.element.style.transform="translateX("+this.x+"px) translateY("+this.y+"px)",this.element.style.width=n.width+"px"}this.height=n.height,this.width=n.width,e.noBody||(this.physics=createPhysicsForElement(this.element,this.physicsOptions)),this.id=this.physics.id;var s=this.actions;this.actions={};for(i=0;i<s.length;++i)this.actions[s[i]]=0;e.noBody||(Matter.World.add(game.engine.world,[this.physics]),game.addObject(this))}};return t.init(),t}function resetElementPosition(e){e.style.top=0,e.style.left=0,e.style.bottom="",e.style.right=""}!function(){const e=[],t=[];var n=!1;const i={score:{player1:0,player2:0,total1:0,total2:0,max:window.Settings.playTo||2,winner:!1,loser:!1},physicsStepMS:1e3/60/2,physicsSamplingRatio:2,terrainLinePercent:50,minTerrainChange:5,centerX:0,freezeFrames:0,leftGoalEnabled:!1,rightGoalEnabled:!1,ownGoalCooldownMS:1e3,ownGoalCooldownTimerMS:0,mode:"off",goalTimeoutMS:Settings.goalTimeoutMS,timeSinceEndzoneHitMS:Settings.goalTimeoutMS,boardWidth:0,boardHeight:0,timeBetweenRoundsMS:2e3,powerupManager:null,paddles:[],balls:[],aiManager:null,activeSpinPowerups:0,pauseManager:null,flashTimeout:!1,objectsToRender:e,roundDurationMS:0,init:function(e,t){this.menuControls=e,this.pauseManager=t,this.worldEl=document.querySelector(".world"),this.tiltEl=document.querySelector(".tilt-wrapper"),this.bodyEl=document.querySelector("body"),this.surfaceOverlayEl=document.querySelector(".screen.game .surface .overlay"),this.messageEl=document.querySelector(".top-message"),this.spinWallEls=document.querySelectorAll(".spin-wall"),this.terrainOneEl=document.querySelector(".terrain.one"),this.terrainTwoEl=document.querySelector(".terrain.two"),this.goalOneEl=document.querySelector(".goal.one"),this.goalTwoEl=document.querySelector(".goal.two"),this.betweenRoundsEl=document.querySelector(".between-round-score"),this.boardWidth=this.worldEl.clientWidth,this.boardHeight=this.worldEl.clientHeight,i.score.player1=0,i.score.player2=0,i.score.total1=0,i.score.total2=0,i.score.winner=!1,i.score.loser=!1,i.terrainLinePercent=50,i.activeSpinPowerups=0,i.score.max=window.Settings.playTo||2,SoundManager.musicEngine.addBeatCallback(()=>{starsRadiusModifier=maxStarsRadiusModifier,this.balls.length>0&&this.balls.forEach(e=>e.excite())}),document.addEventListener("ballHitEndzone",e=>{var t="left"==e.detail.side?2:1;e.detail.lastTouchedPaddle;("right"!==e.detail.side||this.rightGoalEnabled)&&("left"!==e.detail.side||this.leftGoalEnabled)&&this.playerScored(t,e.detail.ball)}),this.powerupManager=new PowerupManager(this),this.aiManager=new AIManager(this,i.engine),this.reactionMachine=new ReactionMachine,initEffects()},lostPowerup:function(e,t){"spin"===t&&(this.activeSpinPowerups--,this.activeSpinPowerups<0&&(this.activeSpinPowerups=0),0===this.activeSpinPowerups&&this.spinWallEls.forEach(function(e){e.style.display="none"}))},ballHitPaddle(e){"running"==i.mode&&(this.leftGoalEnabled=!1,this.rightGoalEnabled=!1,this.goalOneEl.classList.remove("on"),this.goalTwoEl.classList.remove("on"),1===e?(this.rightGoalEnabled=!0,this.goalTwoEl.classList.add("on")):(this.leftGoalEnabled=!0,this.goalOneEl.classList.add("on")))},gotPowerup:function(e,t){"spin"===t&&(this.activeSpinPowerups++,this.spinWallEls.forEach(function(e){e.style.display="block"}))},loserLived:function(){this.setGameMode("off"),this.showMessage("HA! MISSED!",1500),SoundManager.fireEvent("Finish_It_Heartbeat_Stop_Miss"),this.score.loser.mode="normal",this.score.loser.element.classList.remove("loser"),this.score.loser.element.classList.remove("shaking"),setTimeout(()=>{this.removeBalls()},1500),setTimeout(()=>{this.scoreDisplay()},2500),setTimeout(()=>{document.querySelector(".score-satellite").classList.add("fly-up")},2e3)},loserDied:function(){this.setGameMode("off"),this.removeBalls(),SoundManager.fireEvent("Finish_It_Heartbeat_Stop_Hit"),setTimeout(()=>{this.showMessage("YOU MONSTER",1750)},1250),setTimeout(()=>{document.querySelector(".score-satellite").classList.add("fly-up")},2e3),setTimeout(()=>{this.scoreDisplay()},3e3)},scoreDisplay:function(){this.setGameMode("betweenrounds"),this.betweenRoundsEl.style.display="flex",this.betweenRoundsEl.querySelector(".player-1-score").innerText=this.score.player1,this.betweenRoundsEl.querySelector(".player-2-score").innerText=this.score.player2,this.betweenRoundsEl.querySelector("h1").innerText="PLAYER "+(i.score.winner.player+1)+" WINS!",this.betweenRoundsEl.querySelector(".player-1-total-score").innerText=this.score.total1,this.betweenRoundsEl.querySelector(".player-2-total-score").innerText=this.score.total2,this.menuControls.connect(),selectButtonByIndex(0)},rematch:function(){gtag("event","Rematch Clicked",{event_category:"Gameplay"}),this.menuControls.disconnect(),this.score.player1=0,this.score.player2=0,this.betweenRoundsEl.classList.add("fadeout"),setTimeout(()=>{this.betweenRoundsEl.style.display="none",this.betweenRoundsEl.classList.remove("fadeout"),this.restart()},1e3)},pause:function(){this.setGameMode("paused")},destroy:function(){this.setGameMode("paused"),this.destroyGameEnvironment(),this.betweenRoundsEl.style.display="none",SoundManager.musicEngine.removeBeatCallbacks()},resume:function(){this.setGameMode(this.previousMode),this.run()},setPauseManager:function(e){this.pauseManager=e},run:function(){var e=this;!function t(){"paused"!==e.mode&&(0===e.freezeFrames?e.step():e.freezeFrames--,requestAnimationFrame(t))}()},step:function(){var o=Date.now(),s=16;n&&(s=o-n),n=o,this.ownGoalCooldownTimerMS>0&&(this.ownGoalCooldownTimerMS=this.ownGoalCooldownTimerMS-s),this.ownGoalCooldownTimerMS<0&&(this.ownGoalCooldownTimerMS=0),this.timeSinceEndzoneHitMS=this.timeSinceEndzoneHitMS+s,"running"===this.mode&&(this.powerupManager.update(),this.roundDurationMS=this.roundDurationMS+s),this.physicsSamplingRatio=2,this.physicsStepMS=1e3/60/this.physicsSamplingRatio,this.tiltBoard(),BallTrailManager.trailStarted&&BallTrailManager.drawTrail(),e.forEach(e=>{var t=e.element,n=e.physics,i=n.position.x-e.width/2,o=n.position.y-e.height/2,a=n.angle;e.ignoreRotation?t.style.transform="translateX("+i+"px) translateY("+o+"px)":t.style.transform="translateX("+i+"px) translateY("+o+"px) rotate("+a+"rad)",t.style.zIndex=100+parseInt(o),e.update&&e.update(s),e.run&&e.run(s)});for(var a=0;a<this.physicsSamplingRatio;a++)Matter.Engine.update(i.engine,this.physicsStepMS);if(drawParticles(),t.length>0)for(;t.length>0;){let n=t.shift();if(n.deleted)return;n.element.parentNode.removeChild(n.element),Matter.World.remove(i.engine.world,n.physics),e.splice(e.indexOf(n),1),n.deleted=!0}i.balls[0]&&(SoundManager.musicEngine.targetIntensity=i.balls[0].physics.speed)},tiltBoard:function(){var e=deltaY=ballXs=ballYs=n=o=0;if(this.balls.length>0){for(var t of this.balls)ballXs+=t.physics.position.x,ballYs+=t.physics.position.y;var n=ballXs/this.balls.length,o=ballYs/this.balls.length;e=this.boardWidth/2-n,deltaY=this.boardHeight/2-o}var s=20*deltaY/this.boardHeight/2+20,a=-20*e/this.boardWidth/2;"off"!=i.mode&&(this.tiltEl.style.transform="rotateX("+s+"deg) rotateY("+a+"deg)")},showMessage:function(e,t){this.messageEl.classList.add("show-message"),this.messageEl.innerHTML=e,setTimeout(()=>{this.messageEl.classList.remove("show-message")},250),t&&(setTimeout(()=>{this.messageEl.classList.add("remove-message")},t-250),setTimeout(()=>{this.messageEl.innerHTML="",this.messageEl.classList.remove("remove-message")},t))},launchBall:function(){let e=createBall();this.balls.push(e),Matter.Body.set(e.physics,{position:{x:this.boardWidth/2,y:this.boardHeight/2}});var t=.02*(0===Math.floor(getRandom(0,2))?-1:1)*this.physicsSamplingRatio;e.launch(0,t),e.setBPS(SoundManager.musicEngine.bps),SoundManager.playSound("Ball_Spawn"),this.aiManager.setBall(e)},removeBalls:function(){this.balls.forEach(e=>{e.destroy(),t.push(e)}),this.balls=[]},showScore:function(){var e=500,t=document.querySelector(".bigscore-wrapper.one .bigscore"),n=document.querySelector(".bigscore-wrapper.two .bigscore"),i=document.querySelector(".bigscore-wrapper.one .bestof"),o=document.querySelector(".bigscore-wrapper.two .bestof"),s=[t,n,i,o];o.innerHTML="OF "+(2*this.score.max-1),s.map(e=>e.classList.remove("hide-animation")),setTimeout(()=>{t.querySelector(".score-number").innerHTML=this.score.player1,n.querySelector(".score-number").innerHTML=this.score.player2,s.map(e=>e.style.display="block")},e),e+=1e3,setTimeout(()=>{s.map(e=>e.classList.add("hide-animation"))},e),e+=500,setTimeout(()=>{s.map(e=>e.style.display="none")},e)},restart:function(e){gtag("event","Selected Controls",{event_category:"Controls",event_label:`${i.paddles[0].inputComponent.type||"cpu"} - ${i.paddles[1].inputComponent.type||"cpu"}`});let t=parseInt(window.Settings.gamesStarted);if(saveSetting("gamesStarted",t+1),gtag("event","Number of games started",{event_category:"Gameplay Stats",event_label:t+1}),"pregame"===this.mode)return;document.querySelector(".score-satellite").classList.remove("fly-up");let n=e||0;var o=this.score.player1+this.score.player2+2===2*this.score.max;["winner-screen","winner-two","winner-one"].forEach(e=>{this.bodyEl.classList.remove(e)});for(let e of this.paddles)e.reset();this.setGameMode("pregame"),this.terrainLinePercent=50,this.updateBounds(),this.updateScoreDisplay(),setTimeout(()=>{SoundManager.playSound("round-start")},n),n+=50,setTimeout(()=>{this.showScore()},n),n+=1700,setTimeout(()=>{let e=o?"FINAL ROUND!!":"GAME ON!";this.showMessage(e,1500)},n),setTimeout(()=>{this.setGameMode("running"),this.updateBounds(),this.launchBall(),this.pauseManager.enableMenuButton(),this.roundDurationMS=0},n)},updateScoreDisplay:function(){document.querySelector(".player-1-score").innerText=this.score.player1,document.querySelector(".player-2-score").innerText=this.score.player2},updateBounds:function(e){for(var t=0;t<this.paddles.length;t++){var n=this.paddles[t];"running"===this.mode&&(0==n.player?n.maxX=this.boardWidth*(this.terrainLinePercent/100):1==n.player&&(n.minX=this.boardWidth*(this.terrainLinePercent/100))),"pregame"===this.mode&&(0==n.player?n.maxX=.25*this.boardWidth:1==n.player&&(n.minX=this.boardWidth-.25*this.boardWidth))}this.centerX=this.terrainLinePercent/100*this.boardWidth;var i=Math.floor(this.boardWidth*this.terrainLinePercent/100);this.boardWidth;let o=this.terrainLinePercent/100,s=1-this.terrainLinePercent/100;this.terrainOneEl.style.transform="scaleX("+o+")",this.terrainTwoEl.style.transform="scaleX("+s+")";var a=mapScale(this.terrainLinePercent,25,75,0,1);this.surfaceOverlayEl.style.opacity=1-a},gameOver:function(){this.bodyEl.classList.add("winner-screen"),this.goalOneEl.classList.remove("on"),this.goalTwoEl.classList.remove("on"),this.leftGoalEnabled=!1,this.rightGoalEnabled=!1,this.score.loser.setMode("ghost"),this.score.loser.element.classList.add("loser"),this.score.winner==this.paddles[0]?(this.showMessage("Player 1 Wins!",1500),this.bodyEl.classList.add("winner-one"),this.score.total1++):(this.showMessage("Player 2 Wins!",1500),this.bodyEl.classList.add("winner-two"),this.score.total2++);let e=i.paddles[0].inputComponent.type||"cpu",t=i.paddles[1].inputComponent.type||"cpu";if("cpu"!=e||"cpu"!=t)for(var n=0;n<this.paddles.length;n++)void 0===i.paddles[n].inputComponent.type&&(i.paddles[n]===this.score.winner?gtag("event","CPU Beat Player",{event_category:"CPU Performance"}):gtag("event","CPU Lost to Player",{event_category:"CPU Performance"}));let o=!1;if("cpu"!=e&&"cpu"!=t?o="Player vs Player":"cpu"==e&&"cpu"!=t?o="Player vs CPU":"cpu"!=e&&"cpu"==t&&(o="Player vs CPU"),0!=o){let e=5*Math.ceil(this.roundDurationMS/1e3/5);gtag("event","Round Time - "+o,{event_category:"Gameplay",event_label:e+"s"})}setTimeout(()=>{var e=this.score.loser.physics.bounds.min.y,t=this.score.loser.physics.bounds.max.y,n=t+(e-t)/2;if(this.score.loser.element.classList.add("shaking"),this.score.winner==this.paddles[0])var i=600;else i=200;this.showMessage("FINISH IT!!!");let o=createBall({x:i,y:n-15});o.element.classList.add("show"),this.balls.push(o),SoundManager.playSound("Ball_Spawn"),SoundManager.fireEvent("Finish_It_Heartbeat_Start"),this.aiManager.setBall(o),this.setGameMode("finish")},2e3);let s=parseInt(window.Settings.gamesFinished);saveSetting("gamesFinished",s+1),gtag("event","Number of games finished",{event_category:"Gameplay Stats",event_label:s+1})},roundOver:function(e){var t,n;this.paddles[0].maxX=!1,this.paddles[1].minX=!1,this.leftGoalEnabled=!1,this.rightGoalEnabled=!1,this.goalOneEl.classList.remove("on"),this.goalTwoEl.classList.remove("on"),e&&e.physics.speed>e.wordSpeed&&addFakeBall(e.physics),this.removeBalls(),this.setGameMode("roundover"),this.bodyEl.classList.add("winner-screen"),100==this.terrainLinePercent?(t=this.paddles[0],n=this.paddles[1],this.score.player1=this.score.player1+1):(t=this.paddles[1],n=this.paddles[0],this.score.player2=this.score.player2+1),this.updateScoreDisplay(),SoundManager.playSound("Win_Cheer"),t==this.paddles[0]?this.bodyEl.classList.add("winner-one"):this.bodyEl.classList.add("winner-two"),this.score.player2==this.score.max||this.score.player1==this.score.max?(this.score.winner=t,this.score.loser=n,this.gameOver()):(this.showMessage("NICE ROUND!",2e3),setTimeout(()=>{this.restart()},this.timeBetweenRoundsMS)),this.powerupManager.activePowerups.forEach(e=>{"mine"===e.type&&(e.lifeSpan=getRandom(0,50))})},unghostBall(){for(let e of i.balls)e.element.classList.remove("ghost");for(let e of i.paddles)e.physics.collisionFilter.category=1},playerScored:function(e,t){var n=this.balls.find(e=>e.id===t.id);if(!(this.timeSinceEndzoneHitMS<this.goalTimeoutMS)&&(this.timeSinceEndzoneHitMS=0,"off"!==this.mode&&"finish"!==this.mode)){var o=e,s=2;2==o&&(s=1);var a=!0;if(n.lastTouchedPaddle==s&&(0!=this.ownGoalCooldownTimerMS&&(a=!1),this.ownGoalCooldownTimerMS=this.ownGoalCooldownMS),a){var r="left",l=i.boardWidth;if(2==o&&(r="right",l=0),t){for(let e of i.balls)e.element.classList.add("ghost");for(let e of i.paddles)o===e.player&&(e.physics.collisionFilter.category=2);setTimeout(()=>{this.unghostBall()},300)}makeExplosion(l,t.position.y,75,r);var u=Math.abs(t.velocity.x*this.physicsSamplingRatio)/15,c=this.minTerrainChange+15*u;if(c>=10){let e=["OW","NICE","OOF","POW"];showMessage({text:e[Math.floor(Math.random()*e.length)],x:t.position.x,y:t.position.y,fontSize:20+15*u,timeout:2750}),document.dispatchEvent(new CustomEvent("emotion",{detail:{player:s,type:"losing"}}))}this.moveTerrain(o,c,n),100!==this.terrainLinePercent&&0!==this.terrainLinePercent||(this.roundOver(n),SoundManager.musicEngine.addIntensity(50)),addTemporaryClassName(this.bodyEl,"team-"+e+"-scored-flash",500),SoundManager.playRandomSoundFromBank("score")}}},moveTerrain(e,t,n){var i,o;"running"==this.mode&&(1===e?(i=1,o="pink-chunk"):2===e&&(i=-1,o="green-chunk"),makeTerrainChunks(this.terrainLinePercent,i,o,this.boardWidth,this.boardHeight),this.terrainLinePercent=1===e?this.terrainLinePercent+t:this.terrainLinePercent-t,this.terrainLinePercent>100?this.terrainLinePercent=100:this.terrainLinePercent<0&&(this.terrainLinePercent=0),this.updateBounds())},addObject:t=>{e.push(t)},removeObject:e=>{t.push(e)},setGameMode:function(e){this.previousMode=this.mode,this.mode=e,"running"!==e?this.pauseManager.disableMenuButton():this.pauseManager.enableMenuButton()},setupGameEnvironment:e=>{i.engine=Matter.Engine.create(),i.world=i.engine.world,CollisionManager(i.engine);var t=document.querySelector(e);i.boardWidth=t.clientWidth,i.addWalls({width:t.clientWidth,height:t.clientHeight,sides:["top","right","bottom","left"]}),i.world.bounds.min.x=0,i.world.bounds.max.x=t.clientWidth,i.world.bounds.min.y=0,i.world.bounds.max.y=t.clientHeight,i.world.gravity.y=0,i.world.gravity.x=0,Matter.Resolver._restingThresh=.1},destroyGameEnvironment:function(){for(this.leftGoalEnabled=!1,this.rightGoalEnabled=!1,this.goalOneEl.classList.remove("on"),this.goalTwoEl.classList.remove("on"),e.forEach(e=>{e.deleted||(e.element.parentNode.removeChild(e.element),Matter.World.remove(i.engine.world,e.physics),e.deleted=!0)});e.length>0;)e.shift();for(;t.length>0;)t.shift();i.balls.forEach(e=>{e.element.parentNode&&e.element.parentNode.removeChild(e.element)}),i.paddles.forEach(e=>{e.element.parentNode&&e.element.parentNode.removeChild(e.element)}),i.powerupManager.destroy(),i.balls=[],i.paddles=[],i.engine=null,i.world=null},addWalls:function(e){for(var t=e.width,n=e.height,o=e.sides,s=0;s<o.length;s++){var a,r,l,u,c=o[s];"top"==c?(a=t/2,r=-150,l=t,u=300):"left"==c?(a=-150,r=n/2,l=300,u=n):"right"==c?(a=t+150,r=n/2,l=300,u=n):"bottom"==c&&(a=t/2,r=n+150,l=t,u=300);var d=Matter.Bodies.rectangle(a,r,l,u,{isStatic:!0,label:"wall-"+c});d.friction=e.friction||0,Matter.World.add(i.engine.world,d)}}};window.game=i}(),function(){const e={"wall-left":{type:"ballHitEndzone",detail:{side:"left",belongsToPlayer:0}},"wall-right":{type:"ballHitEndzone",detail:{side:"right",belongsToPlayer:1}},"wall-top":{type:"ballHitSide",detail:{side:"top"}},"wall-bottom":{type:"ballHitSide",detail:{side:"bottom"}},"paddle-one":{type:"ballHitPaddle",detail:{player:1}},"paddle-two":{type:"ballHitPaddle",detail:{player:2}}};window.CollisionManager=function(t){Matter.Events.on(t,"collisionEnd",function(t){for(var n=t.pairs,i=0,o=n.length;i!=o;++i){var s=n[i],a=[];a.push(s.bodyA.label),a.push(s.bodyB.label);var r=a.indexOf("ball");if(r>-1){var l=a[(r+1)%2];if(t=e[l]){var u;let e;u="ball"==s.bodyA.label?s.bodyA:s.bodyB;for(var c=0;c<game.balls.length;c++)u===game.balls[c].physics&&(e=game.balls[c]);e&&(t.detail.lastTouchedPaddle=e.lastTouchedPaddle,t.detail.ball=u),document.dispatchEvent(new CustomEvent(t.type,{detail:t.detail}))}}for(c=0;c<game.objectsToRender.length;c++){var d;if(game.objectsToRender[c].physics===s.bodyA)(d=game.objectsToRender[c]).hit&&d.hit(s.bodyB);if(game.objectsToRender[c].physics===s.bodyB)(d=game.objectsToRender[c]).hit&&d.hit(s.bodyA)}}})}}();const paddleKeyboardActions=["up","left","down","right","spinClockwise","spinCounterClockwise"],paddleGamepadActions=["moveX","moveY","spinX","spinY"],paddleActions=paddleKeyboardActions.concat(paddleGamepadActions),frictionAir=.2,maxForce=.016,spinSpeed=.2,maxSpinVelocity=2.7,HALF_PI=Math.PI/2,EIGHTH_PI=Math.PI/8,spinVelocity=.2/game.physicsSamplingRatio,maxAngularVelocity=.0905,angularSpeedThreshold=.02,spinDeltaThreshold=.03490658503988659,slowerSpinDampeningFactor=.5,boneDisappearSounds=SoundManager.findSounds("Powerup_Bones_Disapear_"),updateFunctions={moveXY:function(e){let t=0,n=0;e.actions.left&&t--,e.actions.right&&t++,e.actions.up&&n++,e.actions.down&&n--;let i=Math.atan2(t,n);if(0!=t||0!=n){let t=.016*Math.sin(i)*game.physicsSamplingRatio,n=-.016*Math.cos(i)*game.physicsSamplingRatio;e.force(t,n),e.physics.frictionAir=frictionAir/game.physicsSamplingRatio}},stagedSpin:function(e){let t=0;if(e.actions.spinClockwise&&(t=1),e.actions.spinCounterClockwise&&(t=-1),0!==t){let n=t*spinVelocity;e.spin(n),n>0?e.targetAngle=Math.ceil(e.physics.angle/HALF_PI)*HALF_PI:n<0&&(e.targetAngle=Math.floor(e.physics.angle/HALF_PI)*HALF_PI)}},analogSpin:function(e){let t=Math.abs(e.actions.spinX)>Math.abs(e.actions.spinY)?"X":"Y";if(Math.abs(e.actions.spinX)>.4&&"X"==t){let t=e.actions.spinX>0?1:-1,n=spinVelocity*t;e.spin(n),e.targetAngle=n>=0?Math.ceil(e.physics.angle/HALF_PI)*HALF_PI:Math.floor(e.physics.angle/HALF_PI)*HALF_PI}if(Math.abs(e.actions.spinY)>.4&&"Y"==t){let t=e.actions.spinY>0?-1:1,n=spinVelocity*t;e.spin(n),e.targetAngle=n>=0?Math.ceil(e.physics.angle/HALF_PI)*HALF_PI:Math.floor(e.physics.angle/HALF_PI)*HALF_PI}},moveAnalog:function(e){var t=e.actions.moveX,n=e.actions.moveY;t>.9&&(t=1),t<-.9&&(t=-1),n>.9&&(n=1),n<-.9&&(n=-1);var i=Math.atan2(t,n),o=Math.sqrt(Math.pow(Math.abs(t),2)+Math.pow(Math.abs(n),2))||1;o>1&&(o=1);var s=.016*o;if(0!=t||0!=n){var a=Math.sin(i)*s*game.physicsSamplingRatio*e.movementRatio,r=Math.cos(i)*s*game.physicsSamplingRatio*e.movementRatio;e.force(a,r)}},limitXY:function(e){var t=1.25*game.physicsSamplingRatio;if(e.maxX)if(e.physics.position.x>e.maxX){if(e.hasNoclipPowerup)return void(e.inEnemyTerritory||(e.inEnemyTerritory=!0,SoundManager.fireEvent("Ghost_Enters_Paddle_Enemy_Territory")));e.force(-.016*t,0)}else e.inEnemyTerritory&&(e.inEnemyTerritory=!1,SoundManager.fireEvent("Ghost_Leaves_Paddle_Enemy_Territory"));if(e.minX)if(e.physics.position.x<e.minX){if(e.hasNoclipPowerup)return void(e.inEnemyTerritory||(e.inEnemyTerritory=!0,SoundManager.fireEvent("Ghost_Enters_Paddle_Enemy_Territory")));e.force(.016*t,0)}else e.inEnemyTerritory&&(e.inEnemyTerritory=!1,SoundManager.fireEvent("Ghost_Leaves_Paddle_Enemy_Territory"))},spinToTarget:function(e){let t=e.physics.angle-e.targetAngle,n=-2.7*t;n=Math.min(n,2.7),"player"==e.type&&0!==t&&(e.physics.torque=n,t>-.03490658503988659&&t<.03490658503988659&&e.physics.angularSpeed<.02&&(Matter.Body.setAngle(e.physics,e.targetAngle),Matter.Body.setAngularVelocity(e.physics,0))),e.angularVelocityHistory.push(e.physics.angularVelocity),e.angularVelocityHistory.length>50&&e.angularVelocityHistory.shift(),e.averageAngularVelocity=e.angularVelocityHistory.reduce((e,t)=>e+t)/e.angularVelocityHistory.length},capAngularVelocity:function(e){e.physics.angularVelocity>.0905?Matter.Body.setAngularVelocity(e.physics,.0905):e.physics.angularVelocity<-.0905&&Matter.Body.setAngularVelocity(e.physics,-.0905)},spinPowerup:function(e){e.spinPowerupRemaining>0&&(e.spinPowerupRemaining=e.spinPowerupRemaining-e.dt),e.spinPowerupRemaining>0&&(0==e.hasSpinPowerup&&e.element.classList.add("powerup-spin"),e.hasSpinPowerup=!0),e.hasSpinPowerup&&e.spinPowerupRemaining<=0&&(e.spinPowerupRemaining=0,e.hasSpinPowerup=!1,e.element.classList.remove("powerup-spin"),SoundManager.playSound("Powerup_Spin_WareOff"),game.lostPowerup(e.player,"spin"))},expandPowerup:function(e){e.height<e.targetHeight?(e.changeHeight("grow"),e.height>e.targetHeight&&(e.targetHeight=e.height)):e.height>e.targetHeight&&(e.changeHeight("shrink"),SoundManager.playSound("Powerup_Enhance_WareOff"),e.height<e.targetHeight&&(e.targetHeight=e.height))},cloneCleanup:function(e){if("infinite"!=e.lifeSpan&&(e.lifeSpan=e.lifeSpan-e.dt,e.lifeSpan<0&&(popPaddle(e.physics),game.removeObject(e),void 0!==e.cloneIndex))){let t=Math.min(boneDisappearSounds.length,e.cloneIndex+1);SoundManager.playSound("Powerup_Bones_Disapear_"+t)}}};function createPaddle(e){return createObject({selector:(e=e||{}).selector,player:e.player,targetAngle:0,lifeSpan:e.lifeSpan||"infinite",movementRatio:e.movementRatio||1,innerHTML:"<div class='body'><div class='bone'></div></div>",properties:{x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0,classNames:e.classNames||[]},stripPowerups:function(){this.element.classList.remove("powerup-spin"),game.lostPowerup(this.player,"spin"),this.spinPowerupRemaining=0,this.hasSpinPowerup=!1,this.element.classList.remove("powerup-magnet"),this.hasMagnetPowerup=!1,this.hasNoclipPowerup&&SoundManager.playSound("Powerup_Ghost_WareOff"),this.element.classList.remove("powerup-noclip"),this.hasNoclipPowerup=!1,SoundManager.fireEvent("Ghost_Leaves_Paddle_Enemy_Territory"),this.targetHeight=this.baseHeight},setMode:function(e){"ghost"===e&&(this.stripPowerups(),this.mode="ghost")},reset:function(){this.stripPowerups(),this.element.classList.remove("dead"),this.element.classList.remove("loser"),this.element.classList.remove("shaking"),this.mode="normal"},physicsOptions:{mass:2,frictionAir:frictionAir/game.physicsSamplingRatio,label:"paddle-"+["one","two"][e.player],collisionFilter:{category:1}},mode:"normal",type:e.type||"player",powerupDuration:5500,targetHeight:e.height,baseHeight:parseInt(e.height),baseMass:2,baseInertia:6933.333333333333,maxX:!1,minX:!1,setTimeout:!1,swishTimeoutMS:260,actions:paddleActions.concat(paddleGamepadActions),force:function(e,t){Matter.Body.applyForce(this.physics,this.physics.position,{x:e*this.movementRatio,y:t*this.movementRatio})},checkIsPlayerSpinning:function(){let e=this.actions;return!!(e.spinClockwise||e.spinCounterClockwise||Math.abs(e.spinX)>.4||Math.abs(e.spinY)>.4)},spin:function(e){Matter.Body.setAngularVelocity(this.physics,e),this.swishTimeout||"player"!=this.type||(SoundManager.playRandomSoundFromBank("swish"),this.swishTimeout=setTimeout(()=>{this.swishTimeout=!1},this.swishTimeoutMS))},hit:function(e){this.cloneIndex&&SoundManager.playRandomSoundFromBank("bones-collide"),"ghost"==this.mode&&e.label.indexOf("ball")>-1&&(this.element.classList.add("dead"),this.element.classList.remove("shaking"),explodePaddle(this.physics),showMessage({text:"T_T",x:this.physics.position.x,y:this.physics.position.y,fontSize:40,timeout:1e3}),game.loserDied(),this.resetPosition())},resetPosition:function(){console.log("resetPosition"),Matter.Body.setPosition(this.physics,{x:this.properties.x+this.properties.width/2,y:this.properties.y+this.properties.height/2})},changeHeight(e){var t=.05;"shrink"==e&&(t*=-1);var n=JSON.parse(JSON.stringify(this.physics.angle));Matter.Body.setAngle(this.physics,0),Matter.Body.scale(this.physics,1,1+t,this.physics.position),this.height=this.height+this.height*t,this.element.style.height=this.height+"px",Matter.Body.setAngle(this.physics,n),this.physics.mass=this.baseMass,Matter.Body.setInertia(this.physics,this.baseInertia)},hasSpinPowerup:!1,spinPowerupRemaining:0,spinPowerupTime:7500,hasMagnetPowerup:!1,magnetTimeout:!1,magnetDuration:7500,noclipDuration:5e3,noclipTimeout:!1,powerup(e){if("normal"==this.mode){if("grow"==e){this.targetHeight=1.5*this.height,this.element.classList.add("powerup-hit"),game.showMessage("ENHANCE!",1500);var t=this;setTimeout(function(){t.targetHeight=1*t.targetHeight/1.5,t.targetHeight<t.baseHeight&&(t.targetHeight=t.baseHeight)},this.powerupDuration)}if("magnet"==e){this.hasMagnetPowerup=!0,this.element.classList.add("powerup-magnet"),game.showMessage("STICKY!",1500),clearTimeout(this.magnetTimeout);t=this;this.magnetTimeout=window.setTimeout(function(){t.element.classList.remove("powerup-magnet"),t.hasMagnetPowerup=!1,SoundManager.playSound("Powerup_Sticky_WareOff")},this.magnetDuration)}if("noclip"==e){this.hasNoclipPowerup=!0,this.inEnemyTerritory=!1,this.element.classList.add("powerup-noclip"),game.showMessage("NOCLIP!",1500),clearTimeout(this.noclipTimeout);t=this;this.noclipTimeout=window.setTimeout(function(){t.element.classList.remove("powerup-noclip"),t.hasNoclipPowerup=!1,SoundManager.fireEvent("Ghost_Leaves_Paddle_Enemy_Territory"),SoundManager.playSound("Powerup_Ghost_WareOff")},this.noclipDuration)}"spin"==e&&(this.spinPowerupRemaining=this.spinPowerupRemaining+this.spinPowerupTime),"clone"==e&&(game.showMessage("SPOOOOKY!",1500),this.clonePaddle(),game.updateBounds())}},clonePaddle(){this.player;var e=getRandom(3,6);let t=[];for(var n=0;n<=e;n++){var i,o;0==this.player?(i=0,o=150):(i=game.boardWidth-150,o=game.boardWidth);var s=getRandom(i,o),a=getRandom(50,game.boardHeight-50),r=createPaddle({player:this.player,x:s,y:a,height:65,width:20,classNames:["paddle","skeleton"],lifeSpan:getRandom(3500,5500),movementRatio:1.2,type:"clone"});game.paddles.push(r),popPaddle(r.physics),r.setInputComponent(this.inputComponent),t.push(r)}(t=t.sort((e,t)=>e.lifeSpan>t.lifeSpan?1:e.lifeSpan<t.lifeSpan?-1:0)).forEach((e,t)=>e.cloneIndex=t)},init:function(){this.analogSpinDirection=0===this.player?1:-1},frameTicks:0,analogSpinDirection:1,averageAngularVelocity:0,angularVelocityHistory:[],update(e){if(this.dt=e,this.frameTicks++,"ghost"!=this.mode&&"betweenrounds"!=game.mode)this.updateActionsFromInputComponents();else for(let e in this.actions)this.actions[e]=0;this.updateRoutes[this.updateRoute].forEach(e=>e(this))},updateRoutes:{default:[updateFunctions.expandPowerup,updateFunctions.spinPowerup,updateFunctions.moveXY,updateFunctions.moveAnalog,updateFunctions.analogSpin,updateFunctions.stagedSpin,updateFunctions.limitXY,updateFunctions.spinToTarget,updateFunctions.capAngularVelocity,updateFunctions.cloneCleanup]},updateRoute:"default"})}function createBall(e){return createObject({ignoreRotation:!0,innerHTML:"\n      <div class='spinny'></div>\n      <div class='shadow'></div>\n      <div class='body'></div>\n      ",className:"ball",classNames:["ball"],properties:{x:(e=e||{}).x||0,y:e.y||0,height:30,width:30,classNames:e.classNames||[]},lastStepSpeed:0,physicsOptions:{frictionAir:1e-5/game.physicsSamplingRatio,restitution:1,label:"ball",collisionFilter:{category:1,mask:1}},timeSinceHit:0,gotPaddleHit:!1,maxSpeed:16/game.physicsSamplingRatio,maxSpeedSlowdownRatio:.99,hardHitVelocityIncreaseRatio:1.25,wordSpeed:13/game.physicsSamplingRatio,minWordSpeed:10/game.physicsSamplingRatio,phrases:["BOOOOOOOOM","THHHHHWAP","KA-JAAAAAAAAANG","BA-DOOOM","KA-BLAAAAM","FWOOOSH","WHAAAAAAM","KA-POOOOOOOW"],wordInProgress:!1,wordString:!1,wordDirection:"",letterIndex:0,startedGoingFast:!1,frameTick:0,displayAngle:0,rotationVelocity:0,rotationVelocityMax:20,rotationAccel:2,goingFast:!1,timeSpentGoingFastMS:0,timeAllowedGoingFastMS:5e3,brakesModeEnabled:window.Settings.brakesModeEnabled,slowSpeedTarget:9/game.physicsSamplingRatio,applyBrakes:!1,brakesModeRatio:.985,goalsWhileFastAllowed:2,goalsWhileFast:0,goingFastSpeedThreshold:11/game.physicsSamplingRatio,hasTargetSpeed:!1,targetSpeed:!1,prepSpin:!1,canSpin:!1,spinDirection:!1,lastHitPaddle:!1,lastTouchedPaddle:!1,wooshPlayed:!1,wasRotating:!1,wasSpinning:!1,frameTicks:0,hasTrail:!1,isSpinning:!1,spinSoundSequenceManager:new SoundManager.sequences.Powerup_Spin,changeVelocityRatio:function(e){Matter.Body.setVelocity(this.physics,{x:this.physics.velocity.x*e,y:this.physics.velocity.y*e})},launch:function(e,t){this.element.classList.add("show"),Matter.Body.applyForce(this.physics,this.physics.position,{x:e,y:t})},setTargetSpeed:function(e){this.targetSpeed=e||0,this.element.classList.add("sticky"),this.hasTargetSpeed=!0},removeTargetSpeed:function(){this.element.classList.remove("sticky"),this.hasTargetSpeed=!1},setBPS:function(e){this.bps=e},excite:function(){glowRadius=35},run:function(e){if(this.bodyEl||(this.bodyEl=this.element.querySelector(".body"),this.bodyEl.style.transitionDuration=this.bps+"s"),this.spinnyEl||(this.spinnyEl=this.element.querySelector(".spinny")),this.hasTargetSpeed&&this.physics.speed>this.targetSpeed&&(this.changeVelocityRatio(.9),Math.abs(this.physics.speed-this.targetSpeed)<.1&&this.removeTargetSpeed()),this.frameTicks%2==0&&this.hasTargetSpeed){let e={x:this.physics.position.x-10,y:this.physics.position.y-10,width:20,height:20,className:"oilSlick",lifespan:50,color:"#913987",scaleV:-.005};this.physics.position.x>game.centerX&&(e.color="#2b8e63"),makeParticle(e)}this.frameTicks++,this.physics.speed<this.slowSpeedTarget&&this.applyBrakes&&(this.applyBrakes=!1,this.goalsWhileFast=0),this.applyBrakes&&this.brakesModeEnabled&&this.changeVelocityRatio(this.brakesModeRatio),this.physics.angularSpeed>0&&Matter.Body.setAngularVelocity(this.physics,.95*this.physics.angularVelocity),this.physics.speed>this.maxSpeed&&this.changeVelocityRatio(this.maxSpeedSlowdownRatio);var t=this.physics.velocity.x,n=-this.physics.velocity.y,i=Math.atan2(t,n),o=1,s=1,a=this.physics.speed-6,r=0;a>0&&(o=1+.5*(r=a/5),s=1-.5*r),o>1.5&&(o=1.5),s<.75&&(s=.75),this.bodyEl.style.transform="rotate("+i+"rad) scaleX("+s+") scaleY("+o+")";var l=!1;if(this.canSpin){if("cw"==this.spinDirection){var u=i+Math.PI/2;this.rotationVelocity=this.rotationVelocity+this.rotationAccel,this.rotationVelocity>this.rotationVelocityMax&&(this.rotationVelocity=this.rotationVelocityMax)}else{u=i-Math.PI/2;this.rotationVelocity=this.rotationVelocity-this.rotationAccel,this.rotationVelocity<-this.rotationVelocityMax&&(this.rotationVelocity=-this.rotationVelocityMax)}l=!0}0==l?(this.rotationVelocity>0&&(this.rotationVelocity=this.rotationVelocity-this.rotationAccel),this.rotationVelocity<0&&(this.rotationVelocity=this.rotationVelocity+this.rotationAccel),this.wooshPlayed=!1):(this.physics.speed*game.physicsSamplingRatio<9&&Matter.Body.setVelocity(this.physics,{x:1.06*this.physics.velocity.x,y:1.06*this.physics.velocity.y}),0==this.wooshPlayed&&Math.abs(this.rotationVelocity)==this.rotationVelocityMax&&(this.spinSoundSequenceManager.start(),this.wooshPlayed=!0)),this.hasTrail=!0,this.isSpinning=!1,this.physics.speed*game.physicsSamplingRatio>7&&(Math.abs(this.rotationVelocity/game.physicsSamplingRatio)>0||l)&&(this.isSpinning=!0),this.displayAngle=this.displayAngle+this.rotationVelocity;var c=Math.abs(this.rotationVelocity)/this.rotationVelocityMax,d=.5+.7*c,p=.55*c-.2,m=1;this.rotationVelocity<0&&(m*=-1),this.spinnyEl.style.transform="rotate("+this.displayAngle+"deg) scaleX("+d*m+") scaleY("+d+")",this.spinnyEl.style.opacity=p;var h=15e-5*Math.sin(u)*game.physicsSamplingRatio*this.physics.speed*game.physicsSamplingRatio*c,g=-15e-5*Math.cos(u)*game.physicsSamplingRatio*this.physics.speed*game.physicsSamplingRatio*c;l&&this.physics.speed*game.physicsSamplingRatio>2&&Matter.Body.applyForce(this.physics,this.physics.position,{x:h,y:g}),this.gotPaddleHit&&(this.gotPaddleHit=!1,this.timeSinceHit=0),this.wordInProgress&&(this.physics.speed>this.minWordSpeed?this.drawLetter():this.endWord()),this.lastStepSpeed=JSON.parse(JSON.stringify(this.physics.speed)),this.wasRotating&&!l&&this.spinSoundSequenceManager.stop(),this.wasRotating=l},startWord:function(){if("running"==game.mode){this.wordInProgress=!0,this.letterIndex=-1;var e=Math.floor(getRandom(0,this.phrases.length));this.wordString=JSON.parse(JSON.stringify(this.phrases[e]))}},drawLetter:function(){var e=180+180*-Math.atan2(this.physics.velocity.x,this.physics.velocity.y)/Math.PI;if(e>=360&&(e-=360),this.frameTick>1){var t=this.wordString.charAt(this.letterIndex);drawLetter(this.physics.position.x,this.physics.position.y,e,t),this.letterIndex++,this.frameTick=0,this.letterIndex>=this.wordString.length&&this.endWord()}this.frameTick++},endWord:function(){this.letterIndex=0,this.wordInProgress=!1},setPaddleInfluence(e){e!=this.lastTouchedPaddle&&"running"===game.mode&&(addChangeAnim(this.element.querySelector(".shadow")),this.element.classList.remove("influence-1"),this.element.classList.remove("influence-2"),this.element.classList.add("influence-"+e)),this.lastTouchedPaddle=e},hit:function(e){let t=!1;if((e.label.indexOf("wall-right")>-1||e.label.indexOf("wall-left")>-1)&&(this.physics.speed>this.goingFastSpeedThreshold?this.goalsWhileFast++:this.goalsWhileFast=0,this.goalsWhileFast>=this.goalsWhileFastAllowed&&(this.applyBrakes=!0)),e.label.indexOf("wall-left")>-1&&2===this.lastTouchedPaddle&&this.endSpin(),e.label.indexOf("wall-right")>-1&&1===this.lastTouchedPaddle&&this.endSpin(),e.label.indexOf("wall-top")>-1||e.label.indexOf("wall-bottom")>-1){let e=this.physics.velocity.x,t=this.physics.velocity.y;Math.atan2(e,t);Math.abs(e),Math.abs(t);let n=Math.abs(e)+Math.abs(t);n<6&&(n=6);let i=.65,o=.45;1===this.lastTouchedPaddle?t<0?(this.spinDirection="cw",this.prepSpin&&!this.canSpin&&(SoundManager.playSound("Powerup_Spin_Startup"),Matter.Body.setVelocity(this.physics,{x:n*i,y:-n*o}))):(this.spinDirection="ccw",this.prepSpin&&!this.canSpin&&(SoundManager.playSound("Powerup_Spin_Startup"),Matter.Body.setVelocity(this.physics,{x:n*i,y:n*o}))):t<0?(this.spinDirection="ccw",this.prepSpin&&!this.canSpin&&(SoundManager.playSound("Powerup_Spin_Startup"),Matter.Body.setVelocity(this.physics,{x:-n*i,y:-n*o}))):(this.spinDirection="cw",this.prepSpin&&!this.canSpin&&(SoundManager.playSound("Powerup_Spin_Startup"),Matter.Body.setVelocity(this.physics,{x:-n*i,y:n*o}))),this.prepSpin&&(this.prepSpin=!1,this.canSpin=!0)}if(e.label.indexOf("powerup")>-1&&this.endSpin(),e.label.indexOf("paddle")>-1){if(e.label.indexOf("one")>-1&&this.setPaddleInfluence(1),e.label.indexOf("two")>-1&&this.setPaddleInfluence(2),game.ballHitPaddle(this.lastTouchedPaddle),!0===game.paddles[this.lastTouchedPaddle-1].hasSpinPowerup?this.prepToSpin():this.endSpin(),this.checkSpeed()&&(t=!0),!0===game.paddles[this.lastTouchedPaddle-1].hasMagnetPowerup){game.paddles[this.lastTouchedPaddle-1].checkIsPlayerSpinning()?this.removeTargetSpeed():(this.setTargetSpeed(0),SoundManager.playRandomSoundFromBank("sticky-hit"),t=!0)}this.applyBrakes=!1,this.goalsWhileFast=0}"finish"==game.mode&&e.label.indexOf("wall")>-1&&game.loserLived();var n=this.physics.speed/20;n>1?n=1:n<.5&&(n=.5);var i=.8*(-game.boardWidth/2+this.physics.position.x)/game.boardWidth/2;t||(e.label.indexOf("wall")>-1?e.label.indexOf("wall-right")>-1&&2===this.lastTouchedPaddle?SoundManager.playRandomSoundFromBank("ball-bounce-own-endzone",{volume:n,pan:i}):e.label.indexOf("wall-left")>-1&&1===this.lastTouchedPaddle?SoundManager.playRandomSoundFromBank("ball-bounce-own-endzone",{volume:n,pan:i}):(e.label.indexOf("wall-top")>-1||e.label.indexOf("wall-bottom")>-1)&&(this.canSpin?SoundManager.playRandomSoundFromBank("spin-wall-bounce"):SoundManager.playSound("Ball_Bounce_Wall",{volume:n,pan:i})):e.label.indexOf("paddle")>-1&&!t&&SoundManager.playSound("Ball_Bounce_Paddle",{volume:n,pan:i}))},prepToSpin:function(){this.canSpin=!1,this.prepSpin=!0,this.element.classList.add("canSpin")},endSpin:function(){this.canSpin=!1,this.prepSpin=!1,this.element.classList.remove("canSpin")},checkSpeed:function(){if(this.physics.speed>this.lastStepSpeed?this.lastPaddleHitHard=!0:this.lastPaddleHitHard=!1,this.lastPaddleHitHard&&this.physics.speed>this.wordSpeed){if(!game.paddles[this.lastTouchedPaddle-1].checkIsPlayerSpinning())return;this.wordInProgress||this.startWord();var e=this.physics.velocity.x,t=this.physics.velocity.y,n=180*Math.atan2(e,t)/Math.PI;return fireGun(this.physics.position.x,this.physics.position.y,n,this.lastTouchedPaddle),game.freezeFrames=20,this.changeVelocityRatio(this.hardHitVelocityIncreaseRatio),!0}},destroy:function(){this.spinSoundSequenceManager.stop()}})}!function(){var e={taunting:["cat-mischevious.svg","sunglasses.svg"],embarrassed:["zipper-mouth.svg"],winning:["hands-up.svg","happy-tongue-out.svg","smiling.svg"],strong:["flex.svg"],scared:["hands-praying.svg"],losing:["angry-teeth.svg","cat-crying.svg","cat-mad.svg","crying-bigtime.svg","sad-downlook.svg","self-berated.svg"]};window.ReactionMachine=function(){var t=Array.prototype.slice.call(document.querySelectorAll(".reaction-container"));document.addEventListener("emotion",function(e){n.react(e.detail.player,e.detail.type)});var n={react:function(n,i){var o=e[i],s=o[Math.floor(Math.random()*o.length)],a=t[n-1].cloneNode(!0);document.body.appendChild(a),a.querySelector(".emoji").style.backgroundImage='url("assets/emojis/'+s+'")',setTimeout(function(){a.classList.add("show"),setTimeout(function(){a.classList.remove("show"),setTimeout(function(){setTimeout(function(){a.parentNode.removeChild(a)},500)},250)},1e3)},50)}};return n}}(),window.FrameRateMonitor=function(){const e=[],t=["|","\\","—","/"];for(let t=0;t<15;++t)e[t]=0;const n=document.createElement("div");n.id="fps",document.body.appendChild(n);var i=performance.now(),o=0,s=0,a=0,r=0;!function l(){++a;var u=performance.now();if(u-i>1e3){i=u,e[o]=a,++s;let l=e[0];for(let t=1;t<15&&t<s;++t)l+=e[t];r=Math.round(l/Math.min(15,s)),n.textContent=t[s%4]+r,a=0,o=(o+1)%15}requestAnimationFrame(l)}()};let glowRadius=35;function saveSetting(e,t){window.Settings[e]=t,window.localStorage.setItem("settings",JSON.stringify(window.Settings))}!function(){let e,t,n,i,o=!1;let s=[],a=20,r=1,l=0,u=!1,c=4,d=0;EasingFunctions={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},window.BallTrailManager={startBallTrail:function(){e=document.querySelector(".particle-canvas"),i=890,n=540,e.width=850,e.height=500,t=e.getContext("2d"),o=!0},drawTrail:function(){l++;let e=game.balls[0],o=!1,p=!1;e&&(o=1===e.lastTouchedPaddle||2===e.lastTouchedPaddle,r=mapScale(e.physics.speed,2,10,0,1)),e&&o&&(1===e.lastTouchedPaddle&&(u="#dd58d3"),2===e.lastTouchedPaddle&&(u="#58e8a6"),e.isSpinning&&(u="#39f6ff"),e.hasTrail&&(p=!0,s.push({x:parseFloat(game.balls[0].physics.position.x),y:parseFloat(game.balls[0].physics.position.y),speed:parseFloat(game.balls[0].physics.speed),frame:parseInt(l),color:u}))),s.length>a&&s.shift(),0==p&&s.length>0&&s.shift(),t.clearRect(0,0,i,n),parseInt(s.length*r);let m=parseInt(r*s.length);e&&e.isSpinning&&(m=20),d<m?d++:d>m&&d--;let h=1;for(var g=s.length-d+1;g<s.length;g++){let e=s[g],n=s[g-1];t.lineJoin=t.lineCap="round",t.beginPath(),t.strokeStyle=e.color,t.moveTo(n.x,n.y);let i=h/d;h++;let o=EasingFunctions.easeOutQuart(i);t.lineTo(e.x,e.y),t.lineWidth=36*o,u&&t.stroke()}e&&o&&e.physics.speed<c&&(glowRadius-=.35,!Settings.music&&glowRadius<24&&(glowRadius=35,starsRadiusModifier=maxStarsRadiusModifier),glowRadius<=0&&(glowRadius=0),t.beginPath(),t.arc(e.physics.position.x,e.physics.position.y,glowRadius,0,2*Math.PI,!1),t.fillStyle=u,t.fill())},get trailStarted(){return o}}}(),function(){const e=[];let t,n,i,o,s,a=0;function r(e){return Array.prototype.forEach.call(document.querySelectorAll(e),e=>{let t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}),document.querySelectorAll(e)}function l(e){return r(e)[0]}ScreenManager.addScreen("rules",{init:()=>{},start:()=>new Promise((h,w)=>{Settings.music&&"stopped"===SoundManager.musicEngine.status&&(SoundManager.musicEngine.cueSong("menu"),SoundManager.musicEngine.fadeIn(2,{loop:!0})),a=0,document.querySelector(".screen.rules").classList.remove("transition-out"),document.querySelector(".rules-nav").classList.remove("transition-out"),document.querySelector(".rules").classList.remove("transition-out"),document.querySelector(".buttons").classList.remove("transition-out"),document.querySelector(".sky").classList.remove("transition-out"),document.querySelector(".canvas-stars").classList.remove("transition-out");let v=createObject({noBody:!0}),P=createObject({noBody:!0});if(o=new InputManager(e=>{let t=e===v?".player-one-controls":".player-two-controls",n=e.inputComponent.type;"keyboard"===e.inputComponent.type&&(n=e.inputComponent.inputToActionMapping.KeyA?"keyboard-left":"keyboard-right"),document.querySelector(t).setAttribute("data-type",n)},"rules"),"AI"===Settings.player1Control?document.querySelector(".player-one-controls").setAttribute("data-type","ai"):o.setupInputForObject(v),"AI"===Settings.player2Control?document.querySelector(".player-two-controls").setAttribute("data-type","ai"):o.setupInputForObject(P),document.querySelector(".screen.rules").classList.add("ready"),r(".nav-button").forEach(function(e){e.addEventListener("click",function(e){SoundManager.playSound("Menu_Select");let t=this.getAttribute("to");S(this,"poke",250),"game"===t?(buttonGleam(e.target),SoundManager.musicEngine.fadeOut(2),ScreenManager.transitionToScreen("game")):"splash"===t&&ScreenManager.transitionToScreen("splash")})}),(t=r(".rules-nav a")).forEach(function(t){let n=t.getAttribute("nav");e.push(n),t.addEventListener("click",function(e){let t=this.getAttribute("nav");y(t),SoundManager.playSound("Menu_Select"),S(e.target,"poke",250),e.preventDefault()})}),p=r(".rule-box"),l(".button.previous").addEventListener("click",function(){f(),SoundManager.playSound("Menu_Select"),S(this,"poke",250)}),l(".button.next").addEventListener("click",function(){S(this,"poke",250),SoundManager.playSound("Menu_Select"),_()}),d=p.length,(m=r(".powerup-row .icon")).forEach(function(e){let t=e.getAttribute("type");g.push(t),e.addEventListener("click",function(e){let t=this.getAttribute("type");u(t),SoundManager.playSound("Menu_Select")})}),c=e[0],window.location.hash){let t=window.location.hash.substr(1);e.indexOf(t)>-1&&(c=t)}y(c),(n=setupInputButtons()).connect(),selectButtonBySelector(".rules-start"),initParticleEngine(".rules .scene",5),s=startParticleLoop(),i=startStars(".screen.rules",50,window.innerWidth,window.innerHeight),h()}),stop:()=>new Promise((e,t)=>{o.destroy(),n.disconnect(),w(".rules-nav","transition-out",100),w(".rules","transition-out",100),w(".buttons","transition-out",100),w(".sky","transition-out",200),w(".canvas-stars","transition-out",200),w(".screen.rules","transition-out",1200),setTimeout(function(){s.stop(),e()},2500)})});const u=e=>{currentPowerup=e,m.forEach(function(e){e.classList.remove("selected")}),document.querySelector(".powerup-row .icon[type="+e+"]").classList.add("selected");let t=document.querySelector("video."+e);document.querySelectorAll(".powerups video").forEach(function(e){t!==e&&(e.style.display="none",e.pause(),e.currentTime=0)}),t.style.display="block",S(t,"videoPop",250),t.play();h[e];document.querySelector(".powerup-explanation .powerup-name").innerText=e,document.querySelector(".powerup-explanation .powerup-effect").innerText=h[e]};let c,d,p,m,h={grow:"Bigger Paddle",ghost:"Go into enemy territory!",spin:"Hit the side for a spinshot!",sticky:"Slow down the ball!",bones:"A paddle army to help you!",mine:"Hit it to the other side!"};const g=[],y=e=>{t.forEach((t,n)=>{let i=t.getAttribute("nav");t.classList.remove("selected"),e===i&&t.classList.add("selected")}),p.forEach((t,n)=>{let i=t.getAttribute("rule");t.style.display="none",e===i&&(t.style.display="block","powerups"===e&&0===document.querySelectorAll(".powerup-row div.selected").length&&u(g[0]))})},_=()=>{if("powerups"===c){let e=g.indexOf(currentPowerup),t=g[++e];if(e<g.length)return void u(t)}let t=e.indexOf(c);++t>=e.length&&(t=0);let n=e[t];if("powerups"===(c=n)){let e=g[0];u(e)}y(n)},f=()=>{if("powerups"===c){let e=g.indexOf(currentPowerup),t=g[--e];if(e>=0)return void u(t)}let t=e.indexOf(c);--t<0&&(t=e.length-1);let n=e[t];if("powerups"===(c=n)){let e=g[g.length-1];u(e)}y(n)};function w(e,t,n){a+=n||0,setTimeout(function(){document.querySelector(e).classList.add(t)},a)}function S(e,t,n){e.classList.remove(t),e.classList.add(t),setTimeout(function(){e.classList.remove(t)},n||1e3)}}(),function(){let e,t,n,i,o,s,a,r,l,u,c=[],d=0,p=!1;function m(e){return Array.prototype.forEach.call(document.querySelectorAll(e),e=>{let t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}),document.querySelectorAll(e)}function h(){s.resetManagedObjects(),s.forgetManagedObjects(),c[0].setInputComponent(null),c[1].setInputComponent(null),"AI"!==Settings.player1Control&&s.setupInputForObject(c[0]),"AI"!==Settings.player2Control&&s.setupInputForObject(c[1])}function g(e){e.forEach(function(e){var t=e.getAttribute("player"),n="player"+t+"Control",i=window.Settings[n];e.classList.remove("ai"),e.classList.remove("keyboard"),e.classList.remove("gamepad"),"AI"===i?(e.classList.add("ai"),e.innerHTML="CPU"):(c[t-1].inputComponent&&("gamepad"===c[t-1].inputComponent.type?e.classList.add("gamepad"):e.classList.add("keyboard")),e.innerHTML="&nbsp;")})}function y(e,t,n){d+=n||0,setTimeout(function(){document.querySelector(e).classList.add(t)},d)}function _(e){e.forEach(function(e){var t=e.getAttribute("data-type");window.Settings[t]?e.classList.add("enabled"):e.classList.remove("enabled")})}ScreenManager.addScreen("splash",{init:()=>{let e=document.querySelector(".screen.splash .credits");r||(r=Array.prototype.slice.call(e.querySelectorAll(".credit"))).forEach(t=>{e.removeChild(t)})},start:()=>new Promise((y,M)=>{!Settings.music||"stopped"!==SoundManager.musicEngine.status&&"ready"!==SoundManager.musicEngine.status||(SoundManager.musicEngine.cueSong("menu"),SoundManager.musicEngine.fadeIn(2,{loop:!0})),d=0,document.querySelector(".screen.splash").classList.remove("transition-out"),document.querySelector(".screen.splash .content .content").classList.remove("transition-out"),document.querySelector(".screen.splash .paddle-guy").classList.remove("transition-out"),document.querySelector(".screen.splash .surface").classList.remove("transition-out"),document.querySelector(".screen.splash .overlay").classList.remove("transition-out"),document.querySelector(".screen.splash .credits").classList.remove("transition-out"),document.querySelector(".screen.splash .large-moon").classList.remove("transition-out"),document.querySelector(".screen.splash .sky").classList.remove("transition-out"),document.querySelector(".screen.splash .canvas-stars").classList.remove("transition-out"),document.querySelector(".screen.splash .start-game").classList.remove("hidden"),document.querySelector(".screen.splash").classList.add("appear"),l=function(e){let t=document.querySelector(".credits"),n=[],i=null,o=null,s=["Executive","Assistant","Planetary","Visual","Monetary"],a=["User","Cinematic","Effect","Wildlife","Robot","Pong","Genetic","Spatial","Quantum","Vacation","Vacuum","Masonic","Geographic","Geological","Mathematics","Financial","Morphology","Destruction","Paddle","Physics","Pentatonic","Flux"],l=["Programming","Assessment","Science","Forecasting","Design","Inquiry","Research","Arbitration","Collection","Verification","Taxation","Molding","Crafting","Production","Appreciation","Accounting","Intake","Organization"],u=["Lead","Carrier","Consultant","Assistant","Support","Tailor","Expert","Professor","Researcher","Manager","Painter","Franchising","Manufacturing"],c=["Bobby Richter","Luke Pacholski"],d=!1,p=-1;return t.innerHTML="",function m(){if(!d){if(o&&(t.removeChild(o),o=null),i&&(i.classList.remove("show"),i.classList.add("after-show"),o=i,i=null),0===n.length){let e=[];for(let t=0,n=Math.round(5+10*Math.random());t<n;++t){let t=c[Math.floor(Math.random()*c.length)],n=a[Math.floor(Math.random()*a.length)],i=l[Math.floor(Math.random()*l.length)],o=n+" "+i;Math.random()<.4&&(o=s[Math.floor(Math.random()*s.length)]+" "+o),Math.random()<.5&&(o+=" "+u[Math.floor(Math.random()*u.length)]),o+=": ";let r=document.createElement("div");r.classList.add("credit");let d=document.createElement("span");d.classList.add("title"),d.textContent=o;let p=document.createElement("span");p.classList.add("name"),p.textContent=t,r.appendChild(d),r.appendChild(p),e.push(r)}(n=r.map(e=>e.cloneNode(!0)).concat(e)).forEach(e=>{e.classList.add("before-show"),t.appendChild(e)})}else{let e=n.shift();e.classList.remove("before-show"),e.classList.add("show"),i=e}p=setTimeout(m,e)}}(),t.classList.add("show"),{stop:()=>{d=!0,p>-1&&clearTimeout(p)}}}(3e3),s=new InputManager(e=>{g(i)},"splash"),initParticleEngine(".screen.splash .content .scene",5),u=startParticleLoop(),b(),c.push(createObject({noBody:!0})),c.push(createObject({noBody:!0})),b(),(e=m(".best-of .option")).forEach(function(e){e.addEventListener("click",function(){addTemporaryClassName(e,"poke",250),buttonGleam(e);var t=parseInt(this.getAttribute("data-value"));saveSetting("playTo",t),P(),SoundManager.playSound("Menu_Select")})}),P(),function(e){e.forEach(function(t){t.addEventListener("click",function(){var t=this.getAttribute("data-powerup"),n=this.classList.contains("enabled");if(n){S(t,"disable");let e=w[t]||"Menu_Select";SoundManager.playSound(e)}else{let e=f[t]||"Menu_Select";SoundManager.playSound(e),S(t,"enable")}addTemporaryClassName(this,"poke",250),v(e)})}),v(e)}(t=m(".powerups .powerup")),function(e){e.forEach(function(t){t.querySelector(".value").addEventListener("click",function(t){addTemporaryClassName(this,"poke",250);var n=this.parentNode,i=n.getAttribute("data-type"),o=window.Settings[i];o?saveSetting(i,!1):(saveSetting(i,!0),buttonGleam(this)),_(e),SoundManager.playSound("Menu_Select"),"music"===i&&(Settings[i]?SoundManager.musicEngine.fadeIn(2,{loop:!0}):SoundManager.musicEngine.stop())})}),_(e)}(n=m(".option-toggle")),function(e){e.forEach(function(t){t.addEventListener("click",function(t){var n=this.getAttribute("player");addTemporaryClassName(this,"poke",250),SoundManager.playSound("Menu_Select");var i="player"+n+"Control",o=window.Settings[i];saveSetting(i,"player"===o?"AI":"player"),h(),g(e),buttonGleam(t.target)})}),g(e)}(i=m(".player-options .player-option")),function(){var e=(t=".start-game",m(t)[0]);var t;gtag("event","Enabled Powerups",{event_category:"Gameplay Settings",event_label:window.Settings.powerUpTypes.join(" - ")}),gtag("event","Best Of",{event_category:"Gameplay Settings",event_label:window.Settings.playTo+1}),e.addEventListener("click",function(e){var t=e.target,n=t.getBoundingClientRect(),i={x:n.x||n.left,y:n.y||n.top,zR:getRandom(-8,8),xRv:getRandom(12,20),yV:7,zV:-40,xV:getRandom(-5,5),oV:-.02,width:20,height:50,className:"start-game-particle",lifespan:1e3};makeParticle(i),SoundManager.playSound("Menu_Start&Blastoff"),SoundManager.playSound("Power_Shot_V1"),t.classList.add("hidden"),buttonGleam(t),e.preventDefault(),p?(SoundManager.musicEngine.fadeOut(2),ScreenManager.transitionToScreen("game")):(p=!0,ScreenManager.transitionToScreen("rules"))})}(),(o=setupInputButtons()).connect(),selectButtonBySelector(".start-game"),a=startStars(".screen.splash",50,window.innerWidth,window.innerHeight),h()}),stop:()=>new Promise((e,t)=>{l.stop(),y(".screen.splash .content .content","transition-out",100),y(".screen.splash .paddle-guy","transition-out",250),y(".screen.splash .surface","transition-out",200),y(".screen.splash .overlay","transition-out"),y(".screen.splash .credits","transition-out"),y(".screen.splash .large-moon","transition-out",200),y(".screen.splash .sky","transition-out",200),y(".screen.splash .canvas-stars","transition-out",200),y(".screen.splash","transition-out",1e3),s.destroy(),o.disconnect(),setTimeout(function(){u.stop(),e()},4e3)})});const f={clone:"Powerup_Bones_Score",grow:"Powerup_Enhance_Score",spin:"Powerup_Spin_Score",mine:"Bomb_Spawn",noclip:"Powerup_Ghost_Score",magnet:"Powerup_Sticky_Score"},w={clone:"Powerup_Bones_Deselect",grow:"Powerup_Enhance_WareOff",spin:"Powerup_Spin_WareOff",noclip:"Powerup_Ghost_WareOff",magnet:"Powerup_Sticky_WareOff",mine:"Bomb_Disable"};function S(e,t){if("disable"===t){var n=window.Settings.powerUpTypes.indexOf(e);n>-1&&window.Settings.powerUpTypes.splice(n,1)}else"enable"==t&&-1===window.Settings.powerUpTypes.indexOf(e)&&window.Settings.powerUpTypes.push(e);window.localStorage.setItem("settings",JSON.stringify(window.Settings))}function v(e){var t=window.Settings.powerUpTypes;e.forEach(function(e){var n=e.getAttribute("data-powerup");t.indexOf(n)>-1?e.classList.add("enabled"):e.classList.remove("enabled")})}function P(){var t=parseInt(window.Settings.playTo)||2;e.forEach(function(e){parseInt(e.getAttribute("data-value"))===t?e.classList.add("selected"):e.classList.remove("selected")})}function b(){var e=document.querySelector(".game-title .actual-title"),t=e.innerText;e.innerText="";for(var n=.1,i=0;i<t.length;i++){var o=t.charAt(i);" "==o&&(o="&nbsp;&nbsp;");var s=document.createElement("span");s.classList.add("letter"),s.innerHTML=o,s.style.animationDelay=n+"s",n+=.1,e.append(s)}}}(),function(){let e,t=0,n=["22,018 Galactic Era","Long since humanity's ascent to hyper-cybernetics, Earth's descendants have achieved their optimal form.","Scattered throughout the galaxy, rival factions of the once proud and unified Photospheric Orbital Nova Group compete for resources.","The two most powerful, Purpolium and Greebesque have been negotiating for control of the supermassive black hole at the galactic center.","Inevitably conflict arises, and the two factions agree to settle the confrontation through modern diplomatic means.","As they summon their most elite warriors from the corners of the Milky Way, the entire galaxy awaits in anticipation of organized warfare on a scale never before seen..."];function i(e,n,i){t+=i||0,setTimeout(function(){document.querySelector(e).classList.add(n)},t)}ScreenManager.addScreen("story",{init:()=>{},start:()=>new Promise((t,i)=>{document.querySelector(".screen.story");let o=document.querySelector(".screen.story .ready");navigator.userAgent.toLowerCase().includes("chrome")||!1?document.querySelector(".story").classList.add("is-chrome"):document.querySelector(".story").classList.add("not-chrome"),window.process&&(Array.prototype.forEach.call(document.querySelectorAll(".in-browser"),e=>{e.setAttribute("hidden",!0)}),Array.prototype.forEach.call(document.querySelectorAll(".in-electron"),e=>{e.removeAttribute("hidden")})),o.classList.add("show"),o.querySelector(".ok").addEventListener("click",()=>{o.classList.remove("show"),setTimeout(function(){!function(e){let t,i,o=document.querySelector(".story-content"),s=o.querySelector(".typer"),a=o.querySelector(".cursor"),r=o.querySelector(".skip");function l(){o.classList.remove("show"),e()}o.classList.add("show"),function e(){let o=n.shift(),r="";for(let e in o)r+="<span>"+o[e]+"</span>";s.innerHTML=r;let u=s.querySelectorAll("span");if(o){let n=0;t=setInterval(()=>{let o=u[n++];if(o){SoundManager.playRandomSoundFromBank("type"),o.classList.add("on");let e=o.getBoundingClientRect();a.style.left=e.right+"px",a.style.top=e.top+"px"}else clearInterval(t),i=setTimeout(e,2e3)},25)}else a.classList.add("off"),l()}(),r.addEventListener("click",e=>{clearTimeout(i),clearInterval(t),l()})}(()=>{ScreenManager.transitionToScreen("splash")})},750)}),particleLoop=startParticleLoop(),e=startStars(".screen.story",50,window.innerWidth,window.innerHeight),t()}),stop:()=>new Promise((e,t)=>{console.log("fadeoutscene"),i(".copyright","transition-out",200),i(".canvas-stars","transition-out",200),setTimeout(function(){particleLoop.stop(),SoundManager.musicEngine.cueSong("menu"),Settings.music&&SoundManager.musicEngine.fadeIn(2,{loop:!0}),e()},1e3)})})}(),function(){let e,t,n,i;function o(){var e=window.innerWidth;let t,n=window.innerHeight-150;t=1200/540>e/n?e/1200:n/540,document.querySelector(".board-wrapper").style.transform="scale("+t+")",document.querySelector(".board-shadow-wrapper").style.transform="scale("+t+")";var o=document.querySelector(".tilt-wrapper").getBoundingClientRect().top/window.innerHeight+.1;i=startStars(".screen.game",30,window.innerWidth,400,!0),document.querySelector(".screen.game .surface").style.top=100*parseFloat(o)+"vh"}ScreenManager.addScreen("game",{init:()=>{},start:()=>new Promise((i,s)=>{window.addEventListener("resize",o),o(),game.setupGameEnvironment(".world");let a=[{player:0,x:80,y:200},{player:1,x:game.boardWidth-100,y:200},{player:0,x:40,y:200},{player:1,x:game.boardWidth-60,y:200}];initParticleEngine(".world");for(var r=0;r<2;r++)game.paddles[r]=createPaddle({player:a[r].player,x:a[r].x,y:a[r].y,height:a[r].height||100,width:20,classNames:["paddle","paddle-"+r]}),document.querySelector('.score-wrapper .input[data-player="'+(r+1)+'"]').setAttribute("data-type","ai"),game.paddles[r].init();if(Settings.showFrameRate)new FrameRateMonitor;n=new InputManager(e=>{var t=game.paddles.indexOf(e),n=document.querySelector('.score-wrapper .input[data-player="'+(t+1)+'"]'),i=n.querySelector(".help");n.setAttribute("data-type",e.inputComponent.type),"keyboard"===e.inputComponent.type?i.innerHTML=Object.keys(e.inputComponent.inputToActionMapping).map(function(e){return e.replace("Key","").replace("ArrowUp","↑").replace("ArrowDown","↓").replace("ArrowLeft","←").replace("ArrowRight","→").replace("Comma",",").replace("Period",".")}).join(""):i.innerHTML="",console.log("%cInput Changed:","color: green",t,e.inputComponent.type)},"game"),Settings.music&&SoundManager.musicEngine.playSongChain("gameplay"),e=setupInputButtons(!0),t=new PauseManager(game,n,e),game.init(e,t);let l=game.paddles[0],u=game.paddles[1];"AI"===Settings.player1Control?l.setInputComponent(game.aiManager.createPaddleAIInputComponent(l,"left")):n.setupInputForObject(l),"AI"===Settings.player2Control?u.setInputComponent(game.aiManager.createPaddleAIInputComponent(u,"right")):n.setupInputForObject(u),game.step(),setTimeout(function(){document.querySelector(".screen.game").classList.add("ready"),document.querySelector(".board-wrapper").classList.remove("hide"),document.querySelector(".score-wrapper").classList.add("show"),document.querySelector(".screen.game").classList.remove("fade-out"),document.querySelector(".screen.game").classList.remove("loading")},300),game.restart(2200),game.run(),i()}),stop:()=>new Promise((i,s)=>{e.disconnect(),n.destroy(),e=null,document.querySelector(".screen.game").classList.add("fade-out"),window.removeEventListener("resize",o),Settings.music?SoundManager.musicEngine.fadeOut(2).then(()=>{t.destroy(),t=null,game.destroy(),i()}):setTimeout(function(){t.destroy(),t=null,game.destroy(),i()},1e3)})})}();